<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="initial-scale=1,user-scalable=no,maximum-scale=1,width=device-width">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <link rel="stylesheet" href="css/leaflet.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jjimenezshaw/Leaflet.Control.Layers.Tree@master/L.Control.Layers.Tree.css">
        <link rel="stylesheet" href="css/qgis2web.css">
        <link rel="stylesheet" href="css/fontawesome-all.min.css">
        <link rel="stylesheet" href="css/leaflet.photon.css">
        <style>
        html, body, #kakao-map, #map {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }
        #kakao-map, #map {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        }
        #kakao-map {
            z-index: 0;
        }
        #map {
            z-index: 1;
            background: transparent;
        }
        .leaflet-popup-content table {
            border-collapse: collapse;
            width: 100%;
        }
        .leaflet-popup-content th,
        .leaflet-popup-content td {
            padding: 2px 6px;
            vertical-align: top;
            word-break: break-word;
            white-space: normal;
        }
        .leaflet-popup-content th {
            text-align: left;
            font-weight: 600;
            white-space: nowrap;
            opacity: 0.85;
        }
        .popup-field-toggle {
            background: rgba(255, 255, 255, 0.95);
            padding: 8px 10px;
            border-radius: 4px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.3);
            max-height: 45vh;
            overflow: auto;
            font: 12px/1.2 Arial, Helvetica, sans-serif;
        }
        .popup-field-toggle .title {
            font-weight: 700;
            margin-bottom: 6px;
        }
        .popup-field-toggle .actions {
            display: flex;
            gap: 6px;
            margin-bottom: 6px;
        }
        .popup-field-toggle .actions button {
            font-size: 11px;
            padding: 2px 6px;
            cursor: pointer;
        }
        .popup-field-toggle label {
            display: flex;
            gap: 6px;
            align-items: center;
            margin: 3px 0;
            cursor: pointer;
            user-select: none;
        }
        .leaflet-tooltip.css_map_data {
            max-width: none !important;
            width: max-content;
            white-space: normal;
			color: #000000 !important;
        	font-weight: bold;
    		text-shadow: 1px 1px 2px white;
        }
        .leaflet-tooltip.css_map_data .q2w-label {
			color : #000000 !important;
            display: inline-block;
            max-width: none !important;
        }
        .q2w-label.q2w-label--single {
            white-space: nowrap;
        }
        .q2w-label.q2w-label--multi {
            white-space: pre-line;
        }
        .labels-hidden .leaflet-tooltip-pane {
            display: none;
        }
		.leaflet-popup-content-wrapper {
		    width: 450px !important;
		    border: 2px solid #0000ff;
		}
		.leaflet-popup-content {
		    width: 420px !important;
		}
		.search-filter-container {
		    position: absolute;
		    top: 15px;
		    left: 60px;
		    z-index: 1000;
		    display: flex;
		    gap: 5px;
		}
		.search-filter-input {
		    width: 200px;
		    padding: 8px 12px;
		    border: 2px solid #0051af;
		    border-radius: 20px;
		    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
		    outline: none;
		    font-size: 14px;
		}
		.search-filter-input:focus {
		    background-color: #f0f7ff;
		}
		.custom-central-popup.leaflet-popup {
			z-index: 10000 !important;
		}
		.popup-image-container img {
		    width: 100%;
		    max-height: 300px;
		    object-fit: contain;
		    border-radius: 8px;
		    margin-bottom: 10px;
		}
        </style>
		<style>
		    #map, #kakao-map { left: 350px !important; width: calc(100% - 350px) !important; }
		    .list-item { padding: 15px; border-bottom: 1px solid #eee; cursor: pointer; transition: background 0.2s; }
		    .list-item:hover { background: #f0f7ff; }
		    .list-item .title { font-weight: bold; font-size: 15px; margin-bottom: 5px; }
		    .list-item .price { color: #d32f2f; font-weight: bold; }
		    .list-item .info { font-size: 13px; color: #666; margin-top: 5px; }
		</style>
		<style>
		    .leaflet-tooltip.css_map_data_B,
		    .leaflet-tooltip.css_map_data_A,
		    .leaflet-tooltip.css_map_data_C,
		    .leaflet-tooltip.css_map_data_D,
		    .leaflet-tooltip.css_map_data_E,
		    .leaflet-tooltip.css_map_data_F,
		    .leaflet-tooltip.css_map_data_G {
		        background-color: transparent !important;
		        border: none !important;
		        box-shadow: none !important;
		        padding: 0 !important;
		        display: block !important; 
		    }
		    .custom-tooltip-box:empty {
		        display: none !important;
		    }
		    .custom-tooltip-box {
		        background-color: #ffffff !important;
		        border: 2px solid #3388ff !important;
		        border-radius: 8px !important;
		        padding: 10px 14px !important;
		        box-shadow: 0 4px 12px rgba(0,0,0,0.25) !important;
		        text-align: center;
		        min-width: 100px;
		        max-width: 250px; 
		    }
		    .text-main {
		        font-weight: bold !important;
		        color: #1a202c !important;
		        font-size: 13px !important;
		        margin-bottom: 2px;
		        white-space: nowrap;
		        overflow: hidden;
		        text-overflow: ellipsis;
		    }
		    .text-price {
		        font-weight: 900 !important;
		        color: #e53e3e !important;
		        font-size: 15px !important;
		        margin-top: 6px;
		        border-top: 1px solid #edf2f7;
		        padding-top: 6px;
		        white-space: nowrap;
		    }
		    .text-price:first-child {
		        border-top: none !important;
		        margin-top: 0 !important;
		        padding-top: 0 !important;
		    }
		    .labels-hidden .css_map_data_A,
		    .labels-hidden .css_map_data_B,
		    .labels-hidden .css_map_data_C,
		    .labels-hidden .css_map_data_D,
		    .labels-hidden .css_map_data_E,
		    .labels-hidden .css_map_data_F,
		    .labels-hidden .css_map_data_G {
		        display: none !important;
		    }
		    .leaflet-tooltip-top.css_map_data_A:before,
		    .leaflet-tooltip-top.css_map_data_B:before,
		    .leaflet-tooltip-top.css_map_data_C:before,
		    .leaflet-tooltip-top.css_map_data_D:before,
		    .leaflet-tooltip-top.css_map_data_E:before,
		    .leaflet-tooltip-top.css_map_data_F:before,
		    .leaflet-tooltip-top.css_map_data_G:before {
		        display: none !important;
		    }
		    /* ë“œë˜ê·¸ ê°€ëŠ¥ ë¼ë²¨ */
		    .leaflet-tooltip.draggable-tooltip {
		        cursor: grab !important;
		    }
		    .leaflet-tooltip.draggable-tooltip:active {
		        cursor: grabbing !important;
		    }
		    /* ê±´ì¶•ë¬¼ ê²€ìƒ‰ ëª¨ë‹¬ */
		    .building-modal-overlay {
		        display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
		        background: rgba(0,0,0,0.5); z-index: 9999; justify-content: center; align-items: center;
		    }
		    .building-modal-overlay.active { display: flex; }
		    .building-modal {
		        background: white; border-radius: 16px; width: 560px; max-height: 85vh;
		        box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; display: flex; flex-direction: column;
		    }
		    .building-modal-header {
		        padding: 20px 24px; background: linear-gradient(135deg, #0051af, #0077ed);
		        color: white; display: flex; align-items: center; justify-content: space-between;
		    }
		    .building-modal-header h3 { margin: 0; font-size: 18px; }
		    .building-modal-body { padding: 24px; overflow-y: auto; flex: 1; }
		    .bm-field { margin-bottom: 14px; }
		    .bm-field label { display: block; font-size: 12px; font-weight: 600; color: #555; margin-bottom: 4px; }
		    .bm-field input, .bm-field select {
		        width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 8px;
		        font-size: 14px; box-sizing: border-box; transition: border 0.2s;
		    }
		    .bm-field input:focus, .bm-field select:focus { border-color: #0051af; outline: none; }
		    .bm-row { display: flex; gap: 12px; }
		    .bm-row .bm-field { flex: 1; }
		    .bm-btn-run {
		        width: 100%; padding: 14px; background: linear-gradient(135deg, #0051af, #0077ed);
		        color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: bold;
		        cursor: pointer; transition: opacity 0.2s; margin-top: 8px;
		    }
		    .bm-btn-run:hover { opacity: 0.9; }
		    .bm-btn-run:disabled { background: #aaa; cursor: not-allowed; }
		    .bm-progress { margin-top: 16px; padding: 14px; background: #f8f9fa; border-radius: 10px; display: none; }
		    .bm-progress-bar { height: 6px; background: #e2e8f0; border-radius: 3px; margin-top: 8px; overflow: hidden; }
		    .bm-progress-fill { height: 100%; background: #0051af; border-radius: 3px; transition: width 0.3s; width: 0%; }
		    .bm-result { margin-top: 16px; display: none; }
		    .bm-result-table { width: 100%; border-collapse: collapse; font-size: 12px; }
		    .bm-result-table th { background: #f1f5f9; padding: 8px; text-align: left; position: sticky; top: 0; }
		    .bm-result-table td { padding: 6px 8px; border-bottom: 1px solid #eee; }
		    .bm-download-btn {
		        display: inline-block; padding: 10px 20px; background: #28a745; color: white;
		        border: none; border-radius: 8px; font-size: 14px; font-weight: bold; cursor: pointer;
		        text-decoration: none; margin-top: 10px;
		    }
		</style>
        <title></title>
    </head>
    <body>
		<!-- ========== ë¡œê·¸ì¸ í™”ë©´ ========== -->
		<div id="login-screen" style="position:fixed; top:0; left:0; width:100%; height:100%; background:linear-gradient(135deg,#0f172a,#1e3a5f); z-index:99999; display:flex; justify-content:center; align-items:center;">
		    <div style="background:white; border-radius:20px; padding:48px 40px; width:380px; box-shadow:0 20px 60px rgba(0,0,0,0.4); text-align:center;">
		        <div style="font-size:48px; margin-bottom:12px;">ğŸ—ºï¸</div>
		        <h2 style="margin:0 0 6px; font-size:22px; color:#1e293b;">ì¤‘ì•™ê°ì • GIS</h2>
		        <p style="margin:0 0 28px; font-size:13px; color:#94a3b8;">ì ‘ì†í•˜ë ¤ë©´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
		        <input type="password" id="login-pw" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"
		            style="width:100%; padding:14px 16px; border:2px solid #e2e8f0; border-radius:12px; font-size:15px; box-sizing:border-box; outline:none; transition:border 0.2s;"
		            onfocus="this.style.borderColor='#0051af'" onblur="this.style.borderColor='#e2e8f0'"
		            onkeydown="if(event.key==='Enter') doLogin()">
		        <div id="login-error" style="color:#dc2626; font-size:12px; margin-top:8px; min-height:18px;"></div>
		        <button onclick="doLogin()"
		            style="width:100%; padding:14px; background:linear-gradient(135deg,#0051af,#0077ed); color:white; border:none; border-radius:12px; font-size:16px; font-weight:bold; cursor:pointer; margin-top:8px; transition:opacity 0.2s;"
		            onmouseover="this.style.opacity='0.9'" onmouseout="this.style.opacity='1'">
		            ë¡œê·¸ì¸
		        </button>
		    </div>
		</div>
		<script>
		// â˜… ë¹„ë°€ë²ˆí˜¸ ì„¤ì • (ì›í•˜ëŠ” ê°’ìœ¼ë¡œ ë³€ê²½í•˜ì„¸ìš”)
		var SITE_PASSWORD = '5989500q!';

		function doLogin() {
		    var pw = document.getElementById('login-pw').value;
		    if (pw === SITE_PASSWORD) {
		        document.getElementById('login-screen').style.display = 'none';
		        sessionStorage.setItem('authenticated', 'yes');
		    } else {
		        document.getElementById('login-error').textContent = 'ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
		        document.getElementById('login-pw').style.borderColor = '#dc2626';
		        document.getElementById('login-pw').value = '';
		        document.getElementById('login-pw').focus();
		    }
		}
		// ì´ë¯¸ ì¸ì¦ëœ ì„¸ì…˜ì´ë©´ ë°”ë¡œ í†µê³¼
		if (sessionStorage.getItem('authenticated') === 'yes') {
		    document.getElementById('login-screen').style.display = 'none';
		}
		</script>

		<div id="side-dashboard" style="position: fixed; top: 0; left: 0; width: 350px; height: 100%; background: white; z-index: 3000; box-shadow: 2px 0 10px rgba(0,0,0,0.1); display: flex; flex-direction: column;">
		    <div style="padding: 20px; border-bottom: 1px solid #eee; background: #f8f9fa;">
		        <h2 style="margin: 0; font-size: 18px; color: #333;">ë§¤ë¬¼ ë¦¬ìŠ¤íŠ¸ <span id="list-count" style="color: #0051af;">0</span></h2>
		    </div>
		    <div id="list-container" style="flex: 1; overflow-y: auto; padding: 10px;">
		        </div>
		</div>
        <div id="kakao-map"></div>
		<div id="map"></div>
		<!-- ë¡œë“œë·° íŒ¨ë„ -->
		<div id="roadview-panel" style="display:none; position:fixed; bottom:0; left:350px; right:0; height:35%; z-index:2000; background:#000; border-top:3px solid #0051af;">
		    <div style="position:absolute; top:0; left:0; right:0; height:32px; background:#0051af; display:flex; align-items:center; padding:0 12px; z-index:1;">
		        <span style="color:white; font-size:13px; font-weight:bold;">ğŸ“· ë¡œë“œë·°</span>
		        <span id="roadview-address" style="color:#cce4ff; font-size:12px; margin-left:10px;"></span>
		        <button onclick="closeRoadview()" style="margin-left:auto; background:transparent; border:none; color:white; font-size:18px; cursor:pointer; line-height:1;">âœ•</button>
		    </div>
		    <div id="roadview" style="position:absolute; top:32px; left:0; right:0; bottom:0;"></div>
		</div>

		<div class="filter-panel" style="position: fixed; top: 20px; left: 370px; z-index: 2000; background: white; padding: 10px 14px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); width: 700px; font-family: sans-serif;">
		    <div style="display: flex; align-items: center; margin-bottom: 8px;">
		        <h4 style="margin: 0; font-size: 13px; color: #333;">ìƒì„¸ í•„í„°</h4>
		        <span id="filter-layer-badge" style="font-size:11px; color:#fff; background:#0051af; padding:2px 7px; border-radius:10px; margin-left:8px;">A ë°ì´í„°</span>
		        <span id="filter-result-count" style="font-size:12px; color:#0051af; font-weight:bold; margin-left:auto;"></span>
		        <button onclick="openBuildingSearchModal()" style="margin-left:10px; padding:4px 10px; background-color:#0051af; color:white; border:none; border-radius:5px; cursor:pointer; font-weight:bold; font-size:11px; white-space:nowrap;">
		            ğŸ—ï¸ ê±´ì¶•ë¬¼ ê²€ìƒ‰
		        </button>
		        <button onclick="exportToExcel()" style="margin-left:6px; padding:4px 10px; background-color:#28a745; color:white; border:none; border-radius:5px; cursor:pointer; font-weight:bold; font-size:11px; white-space:nowrap;">
		            ğŸ“Š ì—‘ì…€ ì €ì¥
		        </button>
		    </div>
		    <div id="dynamic-filter-inputs" style="display:flex; flex-wrap:wrap; gap:6px; align-items:flex-end;"></div>
		    <div style="display:flex; align-items:center; gap:16px; margin-top:8px; padding-top:8px; border-top:1px solid #eee; flex-wrap:wrap;">
		        <div style="display:flex; align-items:center; gap:10px; font-size:12px;">
		            <span style="font-size:11px; font-weight:bold; color:#555; white-space:nowrap;">ğŸ—ºï¸ ì§€ë„</span>
		            <label style="display:flex; align-items:center; gap:3px; cursor:pointer; white-space:nowrap;">
		                <input type="checkbox" class="kakao-layer-toggle" data-type="USE_DISTRICT"> ì§€ì í¸ì§‘ë„
		            </label>
		            <label style="display:flex; align-items:center; gap:3px; cursor:pointer; white-space:nowrap;">
		                <input type="checkbox" class="kakao-layer-toggle" data-type="TRAFFIC"> ğŸš¦ êµí†µ
		            </label>
		            <label style="display:flex; align-items:center; gap:3px; cursor:pointer; white-space:nowrap;">
		                <input type="checkbox" class="kakao-layer-toggle" data-type="ROADVIEW"> ğŸ“· ë¡œë“œë·°
		            </label>
		        </div>
		        <div style="width:1px; height:18px; background:#ddd;"></div>
		        <div style="display:flex; align-items:center; gap:6px; font-size:12px;">
		            <span style="font-size:11px; font-weight:bold; color:#0051af; white-space:nowrap;">ğŸ“‚ GeoJSON</span>
		            <input type="file" id="external-geojson-input" accept=".json,.geojson" style="font-size:11px;">
		        </div>
		    </div>
		    <div id="external-label-controls"></div>
		</div>

		<!-- ê±´ì¶•ë¬¼ ê²€ìƒ‰ ëª¨ë‹¬ -->
		<div class="building-modal-overlay" id="buildingModal">
		    <div class="building-modal">
		        <div class="building-modal-header">
		            <h3>ğŸ—ï¸ ê±´ì¶•ë¬¼ëŒ€ì¥ ê²€ìƒ‰</h3>
		            <button onclick="closeBuildingModal()" style="background:none; border:none; color:white; font-size:22px; cursor:pointer;">âœ•</button>
		        </div>
		        <div class="building-modal-body">
		            <div class="bm-row">
		                <div class="bm-field">
		                    <label>ì‹œë„ *</label>
		                    <input type="text" id="bm-sido" placeholder="ì˜ˆ: ê²½ê¸°ë„" value="ê²½ê¸°ë„">
		                </div>
		                <div class="bm-field">
		                    <label>ì‹œêµ°êµ¬ *</label>
		                    <input type="text" id="bm-sigungu" placeholder="ì˜ˆ: ì´ì²œì‹œ">
		                </div>
		            </div>
		            <div class="bm-row">
		                <div class="bm-field">
		                    <label>ìë©´ë™ (ë¹„ìš°ë©´ ì „ì²´ ìˆœíšŒ)</label>
		                    <input type="text" id="bm-eupmyeondong" placeholder="ì˜ˆ: ì¥í˜¸ì›ì">
		                </div>
		                <div class="bm-field">
		                    <label>ë¦¬ (ì„ íƒ)</label>
		                    <input type="text" id="bm-ri" placeholder="ì˜ˆ: ì¥í˜¸ì›ë¦¬">
		                </div>
		            </div>
		            <div class="bm-field">
		                <label>ê²€ìƒ‰ ìš©ë„ (ì½¤ë§ˆ êµ¬ë¶„)</label>
		                <input type="text" id="bm-uses" placeholder="ì˜ˆ: ì°½ê³ ì‹œì„¤,ì°½ê³ " value="ì°½ê³ ì‹œì„¤,ì°½ê³ ">
		            </div>
		            <div id="bm-server-status" style="font-size:12px; color:#888; margin-bottom:8px;"></div>
		            <button class="bm-btn-run" id="bm-run-btn" onclick="runBuildingSearch()">ğŸ” ê²€ìƒ‰ ì‹œì‘</button>
		            <div class="bm-progress" id="bm-progress">
		                <div style="display:flex; justify-content:space-between; font-size:13px;">
		                    <span id="bm-progress-text">ì¤€ë¹„ ì¤‘...</span>
		                    <span id="bm-progress-count" style="font-weight:bold; color:#0051af;">0ê±´</span>
		                </div>
		                <div class="bm-progress-bar"><div class="bm-progress-fill" id="bm-progress-fill"></div></div>
		            </div>
		            <div class="bm-result" id="bm-result">
		                <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:10px;">
		                    <span style="font-weight:bold; font-size:15px;">ğŸ“‹ ê²€ìƒ‰ ê²°ê³¼: <span id="bm-result-count" style="color:#0051af;">0</span>ê±´</span>
		                    <a class="bm-download-btn" id="bm-download-btn" href="#" style="display:none;">ğŸ“¥ ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</a>
		                </div>
		                <div style="max-height:250px; overflow:auto; border:1px solid #eee; border-radius:8px;">
		                    <table class="bm-result-table">
		                        <thead><tr><th>ì†Œì¬ì§€</th><th>ì£¼ìš©ë„</th><th>ì—°ë©´ì (ã¡)</th><th>ì‚¬ìš©ìŠ¹ì¸ì¼</th><th>êµ¬ì¡°</th></tr></thead>
		                        <tbody id="bm-result-tbody"></tbody>
		                    </table>
		                </div>
		            </div>
		        </div>
		    </div>
		</div>

        <script src="js/qgis2web_expressions.js"></script>
        <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=231190ac1aca72ada0b739110d8a0eb4"></script>
        <script src="js/leaflet.js"></script>
        <script src="js/kakao_base.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/jjimenezshaw/Leaflet.Control.Layers.Tree@master/L.Control.Layers.Tree.js"></script>
        <script src="js/leaflet.rotatedMarker.js"></script>
        <script src="js/leaflet.pattern.js"></script>
        <script src="js/leaflet-hash.js"></script>
        <script src="js/Autolinker.min.js"></script>
        <script src="js/rbush.min.js"></script>
        <script src="js/labelgun.min.js"></script>
        <script src="js/labels.js"></script>
        <script src="js/leaflet.photon.js"></script>
        <script src="data/map_data.js"></script>
		<script src="data/B_data.js"></script>
		<script src="data/C_data.js"></script>
		<script src="data/D_data.js"></script>
		<script src="data/E_data.js"></script>
		<script src="data/F_data.js"></script>
		<script src="data/G_data.js"></script>
        <script>
        var map = L.map('map', {
            zoomControl:false, maxZoom:28, minZoom:1
        }).fitBounds([[37.43966984122166,126.86818683641245],[37.6101521616503,127.1412179712234]]);
        initKakaoBaseMap(map, { mapTypeId: 'ROADMAP' });
        var hash = new L.Hash(map);
        map.attributionControl.setPrefix('<a href="https://github.com/tomchadwin/qgis2web" target="_blank">qgis2web</a> &middot; <a href="https://leafletjs.com" title="A JS library for interactive maps">Leaflet</a> &middot; <a href="https://qgis.org">QGIS</a>');
        var autolinker = new Autolinker({truncate: {length: 30, location: 'smart'}});

        // ========== ë“œë˜ê·¸ ê°€ëŠ¥ ë¼ë²¨ ì‹œìŠ¤í…œ ==========
        var tooltipOffsets = {};

        function getFeatureId(feature) {
            var p = feature.properties;
            return p['ê°ì •ì„œë²ˆí˜¸'] || p['ë¹Œë”©ëª…'] || p['í˜¸í…”ëª…'] || p['ê³¨í”„ì¥ëª…(ì¸ìˆ˜ í›„ ëª…ì¹­)'] || 
                   p['ë¬¼ë¥˜ì„¼í„°ëª…'] || p['ëª…ì¹­'] || p['ì†Œì¬ì§€(í†µ'] || 
                   (p['ìœ„ë„'] + '_' + p['ê²½ë„']) || JSON.stringify(p).substring(0, 80);
        }

        function getStoredOffset(feature, defaultOffset) {
            var fid = getFeatureId(feature);
            if (tooltipOffsets[fid]) return [tooltipOffsets[fid].x, tooltipOffsets[fid].y];
            return defaultOffset;
        }

        function makeDraggableTooltip(layer) {
            if (!layer.getTooltip || !layer.getTooltip()) return;
            var tooltip = layer.getTooltip();
            var el = tooltip.getElement();
            if (!el || el._dragReady) return;
            el._dragReady = true;
            el.classList.add('draggable-tooltip');
            var fid = getFeatureId(layer.feature);

            el.addEventListener('mousedown', function(e) {
                if (e.button !== 0) return;
                e.stopPropagation(); e.preventDefault();
                var startX = e.clientX, startY = e.clientY;
                var cur = tooltipOffsets[fid] || { x: tooltip.options.offset[0], y: tooltip.options.offset[1] };
                map.dragging.disable();
                el.style.cursor = 'grabbing';

                function onMove(ev) {
                    var nx = cur.x + (ev.clientX - startX);
                    var ny = cur.y + (ev.clientY - startY);
                    tooltip.options.offset = [nx, ny];
                    tooltipOffsets[fid] = { x: nx, y: ny };
                    if (layer.getLatLng) tooltip.setLatLng(layer.getLatLng());
                }
                function onUp() {
                    map.dragging.enable();
                    el.style.cursor = 'grab';
                    document.removeEventListener('mousemove', onMove);
                    document.removeEventListener('mouseup', onUp);
                }
                document.addEventListener('mousemove', onMove);
                document.addEventListener('mouseup', onUp);
            });
        }

        function bindDraggableTooltip(layer, content, className, defaultOffset) {
            var offset = getStoredOffset(layer.feature, defaultOffset);
            layer.bindTooltip(content, { permanent: true, direction: 'top', className: className, offset: offset });
            layer.on('tooltipopen', function() { setTimeout(function() { makeDraggableTooltip(layer); }, 50); });
        }

        // ========== íŒì—…/ë¼ë²¨ í•„ë“œ ì„¤ì • ==========
        var popupFieldConfig_map_data = (function() {
            var fields = [
                'ê°ì •ì„œë²ˆí˜¸', 'ë³¸ì‚¬/ì§€ì‚¬', 'ë‹´ë‹¹ì', 'í‰ê°€ì‚¬', 'ê±´ëª…', 'ê±°ë˜ì²˜ëª…', 'ì˜ë¢°ì¸', 'ìƒíƒœ',
                'ì˜ë¢°ì¼ì', 'ë°œì†¡ì¼ì', 'ì†Œìœ ìì „í™”', 'ì±„ë¬´ì', 'ì±„ë¬´ìì „í™”', 'ì˜ë¢°ë¬¸ì„œë²ˆ', 'ì˜ë¢°ë¶€ì„œ',
                'ì œì¶œì²˜', 'ì œì¶œì²˜(Tar', 'ì œì¶œì²˜(T_1', 'ì œì¶œì²˜(T_2', 'ì†Œìœ ì', 'í‰ê°€ëª©ì ', 'ë¬¼ê±´ì¢…ë¥˜',
                'ì£¼ì†Œ', 'ì§€ë²ˆì£¼ì†Œ', 'ìœ„ë„', 'ê²½ë„', 'ì§€ë²ˆì£¼ì†Œ(2', 'ìœ„ë„(2)', 'ê²½ë„(2)'
            ];
            var vis = {};
            for (var i = 0; i < fields.length; i++) vis[fields[i]] = true;
            return { fields: fields, visible: vis };
        })();

		var labelFieldConfig_B_data = {
		    fields: ["ì—°ë²ˆ", "ì†Œì¬ì§€(í†µ", "êµ¬ë¶„", "ì„¸ë¶€ìš©ë„", "ë³´ì¦ê¸ˆ/ì›”", "ì˜ë¢°ê¸ˆì•¡", "(ë‹¨ìˆœ)ì˜ˆìƒìˆ˜ìµë¥ "],
		    visible: {
		        "ì—°ë²ˆ": false, "ì†Œì¬ì§€(í†µ": true, "êµ¬ë¶„": true, "ì„¸ë¶€ìš©ë„": true, 
		        "ë³´ì¦ê¸ˆ/ì›”": true, "ì˜ë¢°ê¸ˆì•¡": true, "(ë‹¨ìˆœ)ì˜ˆìƒìˆ˜ìµë¥ ": true
		    }
		};

		var labelFieldConfig_C_data = {
		    fields: ["ë¬¼ë¥˜ì„¼í„°ëª…", "ì†Œì¬ì§€", "êµ¬ë¶„", "ì—°ë©´ì (Py)", "ì‚¬ìš©ìŠ¹ì¸ì¼", "ì ‘ì•ˆì—¬ë¶€", 
		             "ìƒì˜¨ ê³„ì•½ì›”ì„ëŒ€ë£Œ(ì›/Py)", "ìƒì˜¨ ê³„ì•½ì›”ê´€ë¦¬ë¹„(ì›/Py)", 
		             "ì €ì˜¨ ê³„ì•½ì›”ì„ëŒ€ë£Œ(ì›/Py)", "ì €ì˜¨ ê³„ì•½ì›”ê´€ë¦¬ë¹„(ì›/Py)", 
		             "ì„ëŒ€ë£ŒìƒìŠ¹ë¥ ", "ë ŒíŠ¸í”„ë¦¬ê¸°ê°„"],
		    visible: {
		        "ë¬¼ë¥˜ì„¼í„°ëª…": true, "ì†Œì¬ì§€": true, "êµ¬ë¶„": true, 
		        "ì—°ë©´ì (Py)": true, "ì‚¬ìš©ìŠ¹ì¸ì¼": false, "ì ‘ì•ˆì—¬ë¶€": false,
		        "ìƒì˜¨ ê³„ì•½ì›”ì„ëŒ€ë£Œ(ì›/Py)": true, "ìƒì˜¨ ê³„ì•½ì›”ê´€ë¦¬ë¹„(ì›/Py)": false,
		        "ì €ì˜¨ ê³„ì•½ì›”ì„ëŒ€ë£Œ(ì›/Py)": false, "ì €ì˜¨ ê³„ì•½ì›”ê´€ë¦¬ë¹„(ì›/Py)": false,
		        "ì„ëŒ€ë£ŒìƒìŠ¹ë¥ ": false, "ë ŒíŠ¸í”„ë¦¬ê¸°ê°„": false
		    }
		};

		var labelFieldConfig_D_data = {
		    fields: ["ëª…ì¹­", "ì†Œì¬ì§€", "ì°½ê³ ì¢…ë¥˜", "ì‚¬ìš©ìŠ¹ì¸ì¼", "ê±°ë˜ì‹œì ", "ì—°ë©´ì (í‰)", "ê±°ë˜ê¸ˆì•¡(ì´ì•¡)", "í‰ë‹¹ê°€ê²©(ì›/í‰)"],
		    visible: {
		        "ëª…ì¹­": true, "ì†Œì¬ì§€": true, "ì°½ê³ ì¢…ë¥˜": true,
		        "ì‚¬ìš©ìŠ¹ì¸ì¼": false, "ê±°ë˜ì‹œì ": false,
		        "ì—°ë©´ì (í‰)": true, "ê±°ë˜ê¸ˆì•¡(ì´ì•¡)": false, "í‰ë‹¹ê°€ê²©(ì›/í‰)": true
		    }
		};

		// E ë°ì´í„°ìš© í•„ë“œ ì„¤ì • (ì˜¤í”¼ìŠ¤ ê±°ë˜ì‚¬ë¡€)
		var labelFieldConfig_E_data = {
		    fields: ["ë¹Œë”©ëª…", "ê¶Œì—­", "ì§€ë²ˆì£¼ì†Œ", "ì‚¬ìš©ìŠ¹ì¸ì¼", "ê±°ë˜ë©´ì (í‰)", "ê±°ë˜ê°€ê²©(ì›)", "í‰ë‹¹ ê±°ë˜ê°€ê²©(ì›)", "ë§¤ë„ì", "ë§¤ìˆ˜ì", "í‰ë‹¹ ë³´ì¦ê¸ˆ", "í‰ë‹¹ ì„ëŒ€ë£Œ", "í‰ë‹¹ ê´€ë¦¬ë¹„"],
		    visible: {
		        "ë¹Œë”©ëª…": true, "ê¶Œì—­": true, "ì§€ë²ˆì£¼ì†Œ": true,
		        "ì‚¬ìš©ìŠ¹ì¸ì¼": false, "ê±°ë˜ë©´ì (í‰)": false, "ê±°ë˜ê°€ê²©(ì›)": false,
		        "í‰ë‹¹ ê±°ë˜ê°€ê²©(ì›)": true, "ë§¤ë„ì": false, "ë§¤ìˆ˜ì": false,
		        "í‰ë‹¹ ë³´ì¦ê¸ˆ": false, "í‰ë‹¹ ì„ëŒ€ë£Œ": true, "í‰ë‹¹ ê´€ë¦¬ë¹„": false
		    }
		};

		// F ë°ì´í„°ìš© í•„ë“œ ì„¤ì • (í˜¸í…” ê±°ë˜ì‚¬ë¡€)
		var labelFieldConfig_F_data = {
		    fields: ["í˜¸í…”ëª…", "ì†Œì¬ì§€", "ì„±ê¸‰", "ê±°ë˜ì¼ì", "ë§¤ë§¤ê¸ˆì•¡", "ë¹„ê³ ", "ë“±ê¸°"],
		    visible: {
		        "í˜¸í…”ëª…": true, "ì†Œì¬ì§€": true, "ì„±ê¸‰": true,
		        "ê±°ë˜ì¼ì": false, "ë§¤ë§¤ê¸ˆì•¡": true, "ë¹„ê³ ": false, "ë“±ê¸°": false
		    }
		};

		// G ë°ì´í„°ìš© í•„ë“œ ì„¤ì • (ê³¨í”„ì¥ ê±°ë˜ì‚¬ë¡€)
		var labelFieldConfig_G_data = {
		    fields: ["ê³¨í”„ì¥ëª…(ì¸ìˆ˜ í›„ ëª…ì¹­)", "ì„¸ë¶€ì£¼ì†Œ", "ìš´ì˜ë°©ì‹", "í™€ìˆ˜", "ê±°ë˜ ì›”", "ê±°ë˜ê¸ˆì•¡", "í™€ë‹¹ë‹¨ê°€", "ë§¤ë„ì", "ë§¤ìˆ˜ì", "ê±°ë˜ë°©ì‹"],
		    visible: {
		        "ê³¨í”„ì¥ëª…(ì¸ìˆ˜ í›„ ëª…ì¹­)": true, "ì„¸ë¶€ì£¼ì†Œ": true,
		        "ìš´ì˜ë°©ì‹": true, "í™€ìˆ˜": true,
		        "ê±°ë˜ ì›”": false, "ê±°ë˜ê¸ˆì•¡": true, "í™€ë‹¹ë‹¨ê°€": true,
		        "ë§¤ë„ì": false, "ë§¤ìˆ˜ì": false, "ê±°ë˜ë°©ì‹": false
		    }
		};
		
		// ========== ë¼ë²¨ ë¹Œë“œ í•¨ìˆ˜ ==========
		function buildLabelContent_B_data(feature) {
		    var cfg = labelFieldConfig_B_data;
		    var p = feature.properties;
		    var activeFields = [];
		    if (cfg.visible["ì†Œì¬ì§€(í†µ"]) activeFields.push('<div class="text-main">' + (p['ì†Œì¬ì§€(í†µ'] || '') + '</div>');
		    if (cfg.visible["êµ¬ë¶„"])       activeFields.push('<div class="text-main">' + (p['êµ¬ë¶„'] || '') + '</div>');
		    if (cfg.visible["ì„¸ë¶€ìš©ë„"])   activeFields.push('<div class="text-main">' + (p['ì„¸ë¶€ìš©ë„'] || '') + '</div>');
		    if (cfg.visible["ë³´ì¦ê¸ˆ/ì›”"])  activeFields.push('<div class="text-main">' + (p['ë³´ì¦ê¸ˆ/ì›”'] || '') + '</div>');
		    if (cfg.visible["(ë‹¨ìˆœ)ì˜ˆìƒìˆ˜ìµë¥ "]) activeFields.push('<div class="text-main">' + (p['(ë‹¨ìˆœ)ì˜ˆìƒìˆ˜ìµë¥ '] || p['(ë‹¨ìˆœ)ì˜ˆìƒ'] || '') + '</div>');
		    if (cfg.visible["ì˜ë¢°ê¸ˆì•¡"]) activeFields.push('<div class="text-price">' + (p['ì˜ë¢°ê¸ˆì•¡'] || p['ì˜ë¢°ê¸ˆì•¡('] || '') + '</div>');
		    if (!activeFields.length) return '';
		    return '<div class="custom-tooltip-box">' + activeFields.join('') + '</div>';
		}

		function buildLabelContent_C_data(feature) {
		    var cfg = labelFieldConfig_C_data;
		    var p = feature.properties;
		    var activeFields = [];
		    if (cfg.visible["ë¬¼ë¥˜ì„¼í„°ëª…"] && p['ë¬¼ë¥˜ì„¼í„°ëª…']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ì„¼í„°:</span> ' + p['ë¬¼ë¥˜ì„¼í„°ëª…'] + '</div>');
		    if (cfg.visible["ì†Œì¬ì§€"] && p['ì†Œì¬ì§€']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ìœ„ì¹˜:</span> ' + p['ì†Œì¬ì§€'] + '</div>');
		    if (cfg.visible["êµ¬ë¶„"] && p['êµ¬ë¶„']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">êµ¬ë¶„:</span> ' + p['êµ¬ë¶„'] + '</div>');
		    if (cfg.visible["ì—°ë©´ì (Py)"] && p['ì—°ë©´ì (Py)']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ë©´ì :</span> ' + p['ì—°ë©´ì (Py)'] + ' Py</div>');
		    if (cfg.visible["ì‚¬ìš©ìŠ¹ì¸ì¼"] && p['ì‚¬ìš©ìŠ¹ì¸ì¼']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ìŠ¹ì¸:</span> ' + p['ì‚¬ìš©ìŠ¹ì¸ì¼'] + '</div>');
		    if (cfg.visible["ì ‘ì•ˆì—¬ë¶€"] && p['ì ‘ì•ˆì—¬ë¶€']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ì ‘ì•ˆ:</span> ' + p['ì ‘ì•ˆì—¬ë¶€'] + '</div>');
		    if (cfg.visible["ìƒì˜¨ ê³„ì•½ì›”ì„ëŒ€ë£Œ(ì›/Py)"] && p['ìƒì˜¨ ê³„ì•½ì›”ì„ëŒ€ë£Œ(ì›/Py)']) 
		        activeFields.push('<div class="text-price"><span style="color:#888; font-size:11px;">ìƒì˜¨ ì„ëŒ€:</span> ' + p['ìƒì˜¨ ê³„ì•½ì›”ì„ëŒ€ë£Œ(ì›/Py)'] + 'ì›</div>');
		    if (cfg.visible["ìƒì˜¨ ê³„ì•½ì›”ê´€ë¦¬ë¹„(ì›/Py)"] && p['ìƒì˜¨ ê³„ì•½ì›”ê´€ë¦¬ë¹„(ì›/Py)']) 
		        activeFields.push('<div class="text-price"><span style="color:#888; font-size:11px;">ìƒì˜¨ ê´€ë¦¬:</span> ' + p['ìƒì˜¨ ê³„ì•½ì›”ê´€ë¦¬ë¹„(ì›/Py)'] + 'ì›</div>');
		    if (cfg.visible["ì €ì˜¨ ê³„ì•½ì›”ì„ëŒ€ë£Œ(ì›/Py)"] && p['ì €ì˜¨ ê³„ì•½ì›”ì„ëŒ€ë£Œ(ì›/Py)']) 
		        activeFields.push('<div style="font-weight:900; color:#3182ce; font-size:15px; margin-top:6px; border-top:1px solid #edf2f7; padding-top:6px;"><span style="color:#888; font-size:11px;">ì €ì˜¨ ì„ëŒ€:</span> ' + p['ì €ì˜¨ ê³„ì•½ì›”ì„ëŒ€ë£Œ(ì›/Py)'] + 'ì›</div>');
		    if (cfg.visible["ì €ì˜¨ ê³„ì•½ì›”ê´€ë¦¬ë¹„(ì›/Py)"] && p['ì €ì˜¨ ê³„ì•½ì›”ê´€ë¦¬ë¹„(ì›/Py)']) 
		        activeFields.push('<div style="font-weight:900; color:#3182ce; font-size:15px; margin-top:6px; border-top:1px solid #edf2f7; padding-top:6px;"><span style="color:#888; font-size:11px;">ì €ì˜¨ ê´€ë¦¬:</span> ' + p['ì €ì˜¨ ê³„ì•½ì›”ê´€ë¦¬ë¹„(ì›/Py)'] + 'ì›</div>');
		    if (cfg.visible["ì„ëŒ€ë£ŒìƒìŠ¹ë¥ "] && p['ì„ëŒ€ë£ŒìƒìŠ¹ë¥ ']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ìƒìŠ¹ë¥ :</span> ' + p['ì„ëŒ€ë£ŒìƒìŠ¹ë¥ '] + '</div>');
		    if (cfg.visible["ë ŒíŠ¸í”„ë¦¬ê¸°ê°„"] && p['ë ŒíŠ¸í”„ë¦¬ê¸°ê°„']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ë ŒíŠ¸í”„ë¦¬:</span> ' + p['ë ŒíŠ¸í”„ë¦¬ê¸°ê°„'] + '</div>');
		    if (!activeFields.length) return '';
		    return '<div class="custom-tooltip-box">' + activeFields.join('') + '</div>';
		}

		function buildLabelContent_D_data(feature) {
		    var cfg = labelFieldConfig_D_data;
		    var p = feature.properties;
		    var activeFields = [];
		    if (cfg.visible["ëª…ì¹­"] && p['ëª…ì¹­']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ëª…ì¹­:</span> ' + p['ëª…ì¹­'] + '</div>');
		    if (cfg.visible["ì†Œì¬ì§€"] && p['ì†Œì¬ì§€']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ìœ„ì¹˜:</span> ' + p['ì†Œì¬ì§€'] + '</div>');
		    if (cfg.visible["ì°½ê³ ì¢…ë¥˜"] && p['ì°½ê³ ì¢…ë¥˜']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ì¢…ë¥˜:</span> ' + p['ì°½ê³ ì¢…ë¥˜'] + '</div>');
		    if (cfg.visible["ì‚¬ìš©ìŠ¹ì¸ì¼"] && p['ì‚¬ìš©ìŠ¹ì¸ì¼']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ìŠ¹ì¸:</span> ' + p['ì‚¬ìš©ìŠ¹ì¸ì¼'] + '</div>');
		    if (cfg.visible["ê±°ë˜ì‹œì "] && p['ê±°ë˜ì‹œì ']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ê±°ë˜:</span> ' + p['ê±°ë˜ì‹œì '] + '</div>');
		    if (cfg.visible["ì—°ë©´ì (í‰)"] && p['ì—°ë©´ì (í‰)']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ë©´ì :</span> ' + p['ì—°ë©´ì (í‰)'] + 'í‰</div>');
		    if (cfg.visible["ê±°ë˜ê¸ˆì•¡(ì´ì•¡)"] && p['ê±°ë˜ê¸ˆì•¡(ì´ì•¡)']) 
		        activeFields.push('<div class="text-price"><span style="color:#888; font-size:11px;">ì´ì•¡:</span> ' + p['ê±°ë˜ê¸ˆì•¡(ì´ì•¡)'] + '</div>');
		    if (cfg.visible["í‰ë‹¹ê°€ê²©(ì›/í‰)"] && p['í‰ë‹¹ê°€ê²©(ì›/í‰)']) 
		        activeFields.push('<div style="font-weight:900; color:#16a34a; font-size:15px; margin-top:6px; border-top:1px solid #edf2f7; padding-top:6px;"><span style="color:#888; font-size:11px;">í‰ë‹¹:</span> ' + p['í‰ë‹¹ê°€ê²©(ì›/í‰)'] + '</div>');
		    if (!activeFields.length) return '';
		    return '<div class="custom-tooltip-box">' + activeFields.join('') + '</div>';
		}

		// E ë°ì´í„°ìš© ë¼ë²¨ (ì˜¤í”¼ìŠ¤ - ì²­ë¡)
		function buildLabelContent_E_data(feature) {
		    var cfg = labelFieldConfig_E_data;
		    var p = feature.properties;
		    var activeFields = [];
		    if (cfg.visible["ë¹Œë”©ëª…"] && p['ë¹Œë”©ëª…']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ë¹Œë”©:</span> ' + p['ë¹Œë”©ëª…'] + '</div>');
		    if (cfg.visible["ê¶Œì—­"] && p['ê¶Œì—­']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ê¶Œì—­:</span> ' + p['ê¶Œì—­'] + '</div>');
		    if (cfg.visible["ì§€ë²ˆì£¼ì†Œ"] && p['ì§€ë²ˆì£¼ì†Œ']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ì£¼ì†Œ:</span> ' + p['ì§€ë²ˆì£¼ì†Œ'] + '</div>');
		    if (cfg.visible["ì‚¬ìš©ìŠ¹ì¸ì¼"] && p['ì‚¬ìš©ìŠ¹ì¸ì¼']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ìŠ¹ì¸:</span> ' + p['ì‚¬ìš©ìŠ¹ì¸ì¼'] + '</div>');
		    if (cfg.visible["ê±°ë˜ë©´ì (í‰)"] && p['ê±°ë˜ë©´ì (í‰)']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ë©´ì :</span> ' + p['ê±°ë˜ë©´ì (í‰)'] + 'í‰</div>');
		    if (cfg.visible["ê±°ë˜ê°€ê²©(ì›)"] && p['ê±°ë˜ê°€ê²©(ì›)']) 
		        activeFields.push('<div class="text-price"><span style="color:#888; font-size:11px;">ê±°ë˜ê°€:</span> ' + p['ê±°ë˜ê°€ê²©(ì›)'] + '</div>');
		    if (cfg.visible["í‰ë‹¹ ê±°ë˜ê°€ê²©(ì›)"] && p['í‰ë‹¹ ê±°ë˜ê°€ê²©(ì›)']) 
		        activeFields.push('<div style="font-weight:900; color:#0891b2; font-size:15px; margin-top:6px; border-top:1px solid #edf2f7; padding-top:6px;"><span style="color:#888; font-size:11px;">í‰ë‹¹:</span> ' + p['í‰ë‹¹ ê±°ë˜ê°€ê²©(ì›)'] + '</div>');
		    if (cfg.visible["ë§¤ë„ì"] && p['ë§¤ë„ì']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ë§¤ë„:</span> ' + p['ë§¤ë„ì'] + '</div>');
		    if (cfg.visible["ë§¤ìˆ˜ì"] && p['ë§¤ìˆ˜ì']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ë§¤ìˆ˜:</span> ' + p['ë§¤ìˆ˜ì'] + '</div>');
		    if (cfg.visible["í‰ë‹¹ ë³´ì¦ê¸ˆ"] && p['í‰ë‹¹ ë³´ì¦ê¸ˆ'] && p['í‰ë‹¹ ë³´ì¦ê¸ˆ'] !== '-') 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ë³´ì¦ê¸ˆ:</span> ' + p['í‰ë‹¹ ë³´ì¦ê¸ˆ'] + '</div>');
		    if (cfg.visible["í‰ë‹¹ ì„ëŒ€ë£Œ"] && p['í‰ë‹¹ ì„ëŒ€ë£Œ'] && p['í‰ë‹¹ ì„ëŒ€ë£Œ'] !== '-') 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ì„ëŒ€ë£Œ:</span> ' + p['í‰ë‹¹ ì„ëŒ€ë£Œ'] + '</div>');
		    if (cfg.visible["í‰ë‹¹ ê´€ë¦¬ë¹„"] && p['í‰ë‹¹ ê´€ë¦¬ë¹„'] && p['í‰ë‹¹ ê´€ë¦¬ë¹„'] !== '-') 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ê´€ë¦¬ë¹„:</span> ' + p['í‰ë‹¹ ê´€ë¦¬ë¹„'] + '</div>');
		    if (!activeFields.length) return '';
		    return '<div class="custom-tooltip-box">' + activeFields.join('') + '</div>';
		}

		// F ë°ì´í„°ìš© ë¼ë²¨ (í˜¸í…” - í•‘í¬)
		function buildLabelContent_F_data(feature) {
		    var cfg = labelFieldConfig_F_data;
		    var p = feature.properties;
		    var activeFields = [];
		    if (cfg.visible["í˜¸í…”ëª…"] && p['í˜¸í…”ëª…']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">í˜¸í…”:</span> ' + p['í˜¸í…”ëª…'] + '</div>');
		    if (cfg.visible["ì†Œì¬ì§€"] && p['ì†Œì¬ì§€']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ìœ„ì¹˜:</span> ' + p['ì†Œì¬ì§€'] + '</div>');
		    if (cfg.visible["ì„±ê¸‰"] && p['ì„±ê¸‰']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ì„±ê¸‰:</span> ' + p['ì„±ê¸‰'] + 'ì„±</div>');
		    if (cfg.visible["ê±°ë˜ì¼ì"] && p['ê±°ë˜ì¼ì']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ê±°ë˜:</span> ' + p['ê±°ë˜ì¼ì'] + '</div>');
		    if (cfg.visible["ë§¤ë§¤ê¸ˆì•¡"] && p['ë§¤ë§¤ê¸ˆì•¡']) 
		        activeFields.push('<div style="font-weight:900; color:#db2777; font-size:15px; margin-top:6px; border-top:1px solid #edf2f7; padding-top:6px;"><span style="color:#888; font-size:11px;">ê¸ˆì•¡:</span> ' + p['ë§¤ë§¤ê¸ˆì•¡'] + '</div>');
		    if (cfg.visible["ë¹„ê³ "] && p['ë¹„ê³ ']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ë¹„ê³ :</span> ' + p['ë¹„ê³ '] + '</div>');
		    if (cfg.visible["ë“±ê¸°"] && p['ë“±ê¸°']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ë“±ê¸°:</span> ' + p['ë“±ê¸°'] + '</div>');
		    if (!activeFields.length) return '';
		    return '<div class="custom-tooltip-box">' + activeFields.join('') + '</div>';
		}

		// G ë°ì´í„°ìš© ë¼ë²¨ (ê³¨í”„ì¥ - í™©ê¸ˆ)
		function buildLabelContent_G_data(feature) {
		    var cfg = labelFieldConfig_G_data;
		    var p = feature.properties;
		    var activeFields = [];
		    if (cfg.visible["ê³¨í”„ì¥ëª…(ì¸ìˆ˜ í›„ ëª…ì¹­)"] && p['ê³¨í”„ì¥ëª…(ì¸ìˆ˜ í›„ ëª…ì¹­)']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ê³¨í”„ì¥:</span> ' + p['ê³¨í”„ì¥ëª…(ì¸ìˆ˜ í›„ ëª…ì¹­)'] + '</div>');
		    if (cfg.visible["ì„¸ë¶€ì£¼ì†Œ"] && p['ì„¸ë¶€ì£¼ì†Œ']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ì£¼ì†Œ:</span> ' + p['ì„¸ë¶€ì£¼ì†Œ'] + '</div>');
		    if (cfg.visible["ìš´ì˜ë°©ì‹"] && p['ìš´ì˜ë°©ì‹']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ìš´ì˜:</span> ' + p['ìš´ì˜ë°©ì‹'] + '</div>');
		    if (cfg.visible["í™€ìˆ˜"] && p['í™€ìˆ˜']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">í™€ìˆ˜:</span> ' + p['í™€ìˆ˜'] + 'H</div>');
		    if (cfg.visible["ê±°ë˜ ì›”"] && p['ê±°ë˜ ì›”']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ê±°ë˜ì›”:</span> ' + p['ê±°ë˜ ì›”'] + '</div>');
		    if (cfg.visible["ê±°ë˜ê¸ˆì•¡"] && p['ê±°ë˜ê¸ˆì•¡'] && p['ê±°ë˜ê¸ˆì•¡'] !== '-') 
		        activeFields.push('<div style="font-weight:900; color:#b45309; font-size:15px; margin-top:6px; border-top:1px solid #edf2f7; padding-top:6px;"><span style="color:#888; font-size:11px;">ê¸ˆì•¡:</span> ' + p['ê±°ë˜ê¸ˆì•¡'] + '</div>');
		    if (cfg.visible["í™€ë‹¹ë‹¨ê°€"] && p['í™€ë‹¹ë‹¨ê°€'] && p['í™€ë‹¹ë‹¨ê°€'] !== '-') 
		        activeFields.push('<div style="font-weight:900; color:#b45309; font-size:14px;"><span style="color:#888; font-size:11px;">í™€ë‹¹:</span> ' + p['í™€ë‹¹ë‹¨ê°€'] + '</div>');
		    if (cfg.visible["ë§¤ë„ì"] && p['ë§¤ë„ì']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ë§¤ë„:</span> ' + p['ë§¤ë„ì'] + '</div>');
		    if (cfg.visible["ë§¤ìˆ˜ì"] && p['ë§¤ìˆ˜ì']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ë§¤ìˆ˜:</span> ' + p['ë§¤ìˆ˜ì'] + '</div>');
		    if (cfg.visible["ê±°ë˜ë°©ì‹"] && p['ê±°ë˜ë°©ì‹']) 
		        activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ë°©ì‹:</span> ' + p['ê±°ë˜ë°©ì‹'] + '</div>');
		    if (!activeFields.length) return '';
		    return '<div class="custom-tooltip-box">' + activeFields.join('') + '</div>';
		}

        var labelFieldConfig_map_data = (function() {
            var fields = ['ì œì¶œì²˜(Tar', 'ë‹´ë‹¹ì', 'ì˜ë¢°ì¼ì', 'ìƒíƒœ', 'ì£¼ì†Œ'];
            var vis = {};
            for (var i = 0; i < fields.length; i++) vis[fields[i]] = true;
            return { fields: fields, visible: vis };
        })();

		function buildPopupContent_map_data(feature) {
		    function fmt(v) {
		        if (v === null || v === undefined) return '';
		        return autolinker.link(String(v).replace(/'/g, '\'').toLocaleString());
		    }
		    var props = feature.properties || {};
		    var rows = '';
		    if (props['ê°ì •ì„œë²ˆí˜¸']) { 
		        var id = String(props['ê°ì •ì„œë²ˆí˜¸']).trim();
		        var imgPath = "images/" + id + ".jpg"; 
		        rows += '<tr><td colspan="2" class="popup-image-container" style="text-align:center;">' +
		                '<img src="' + imgPath + '" ' +
		                'style="width:100%; max-height:250px; object-fit:contain; border-radius:8px; margin-bottom:10px;" ' +
		                'onerror="this.src=\'images/' + id + '.png\'; this.onerror=function(){this.style.display=\'none\'};">' + 
		                '</td></tr>';
		    }
		    var cfg = popupFieldConfig_map_data;
		    for (var i = 0; i < cfg.fields.length; i++) {
		        var key = cfg.fields[i];
		        if (!cfg.visible[key]) continue;
		        var val = props[key];
		        if (val === null || val === undefined || val === '') continue;
		        rows += '<tr><th style="min-width:80px; text-align:left;">' + key + '</th><td>' + fmt(val) + '</td></tr>';
		    }
		    return '<table style="width:100%; border-collapse:collapse;">' + 
		           (rows || '<tr><td>ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>') + 
		           '</table>';
		}

        function buildLabelContent_map_data(feature) {
            var cfg = labelFieldConfig_map_data;
            var props = feature && feature.properties ? feature.properties : feature;
            if (!props) return '';
            var activeFields = [];
            for (var i = 0; i < cfg.fields.length; i++) {
                var key = cfg.fields[i];
                if (!cfg.visible[key]) continue;
                var v = props[key];
                if (v === null || v === undefined || v === '') continue;
                // ì£¼ì†ŒëŠ” ë©”ì¸ íƒ€ì´í‹€ë¡œ
                if (key === 'ì£¼ì†Œ') {
                    activeFields.unshift('<div class="text-main" style="font-size:14px;">' + v + '</div>');
                } else if (key === 'ìƒíƒœ') {
                    var stColor = v === 'ì™„ë£Œ' ? '#16a34a' : (v === 'ì§„í–‰' ? '#d97706' : '#64748b');
                    activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">ìƒíƒœ:</span> <span style="color:' + stColor + ';">' + v + '</span></div>');
                } else {
                    var labelMap = {'ì œì¶œì²˜(Tar':'ì œì¶œì²˜', 'ë‹´ë‹¹ì':'ë‹´ë‹¹ì', 'ì˜ë¢°ì¼ì':'ì˜ë¢°ì¼', 'ë¬¼ê±´ì¢…ë¥˜':'ì¢…ë¥˜'};
                    var label = labelMap[key] || key;
                    activeFields.push('<div class="text-main"><span style="color:#888; font-size:11px;">' + label + ':</span> ' + v + '</div>');
                }
            }
            if (!activeFields.length) return '';
            return '<div class="custom-tooltip-box" style="border-color:#85b66f !important;">' + activeFields.join('') + '</div>';
        }
        
        function removeEmptyRowsFromPopupContent(content, feature) {
         var tempDiv = document.createElement('div');
         tempDiv.innerHTML = content;
         var rows = tempDiv.querySelectorAll('tr');
         for (var i = 0; i < rows.length; i++) {
             var td = rows[i].querySelector('td.visible-with-data');
             var key = td ? td.id : '';
             if (td && td.classList.contains('visible-with-data') && feature.properties[key] == null) {
                 rows[i].parentNode.removeChild(rows[i]);
             }
         }
         return tempDiv.innerHTML;
        }
        
        function addClassToPopupIfMedia(content, popup) {
            var tempDiv = document.createElement('div');
            tempDiv.innerHTML = content;
            var imgTd = tempDiv.querySelector('td img');
            if (imgTd) {
                var src = imgTd.getAttribute('src');
                if (/\.(jpg|jpeg|png|gif|bmp|webp|avif)$/i.test(src)) {
                    popup._contentNode.classList.add('media');
                    setTimeout(function() { popup.update(); }, 10);
                } else if (/\.(mp3|wav|ogg|aac)$/i.test(src)) {
                    var audio = document.createElement('audio');
                    audio.controls = true; audio.src = src;
                    imgTd.parentNode.replaceChild(audio, imgTd);
                    popup._contentNode.classList.add('media');
                    setTimeout(function() { popup.setContent(tempDiv.innerHTML); popup.update(); }, 10);
                } else if (/\.(mp4|webm|ogg|mov)$/i.test(src)) {
                    var video = document.createElement('video');
                    video.controls = true; video.src = src;
                    video.style.width = "400px"; video.style.height = "300px";
                    video.style.maxHeight = "60vh"; video.style.maxWidth = "60vw";
                    imgTd.parentNode.replaceChild(video, imgTd);
                    popup._contentNode.classList.add('media');
                    video.addEventListener('loadedmetadata', function() { popup.update(); });
                    setTimeout(function() { popup.setContent(tempDiv.innerHTML); popup.update(); }, 10);
                } else {
                    popup._contentNode.classList.remove('media');
                }
            } else {
                popup._contentNode.classList.remove('media');
            }
        }

        var zoomControl = L.control.zoom({ position: 'topleft' }).addTo(map);
        var bounds_group = new L.featureGroup([]);
        function setBounds() {}

       function pop_map_data(feature, layer) {
		    layer.bindPopup(function(l) {
		        var content = buildPopupContent_map_data(l.feature);
		        var latlng = l.getLatLng();
		        var address = l.feature.properties['ì£¼ì†Œ'] || l.feature.properties['ì†Œì¬ì§€(í†µ'] || l.feature.properties['ì†Œì¬ì§€'] || l.feature.properties['ì„¸ë¶€ì£¼ì†Œ'] || '';
		        content += '<div style="margin-top:8px; text-align:center;">' +
		            '<button onclick="openRoadview({lat:' + latlng.lat + ',lng:' + latlng.lng + '},\'' + address.replace(/'/g, '') + '\')" ' +
		            'style="padding:6px 16px; background:#0051af; color:white; border:none; border-radius:5px; cursor:pointer; font-size:12px; font-weight:bold;">' +
		            'ğŸ“· ì´ ìœ„ì¹˜ ë¡œë“œë·° ë³´ê¸°</button></div>';
		        return content;
		    }, {
		        maxHeight: 500, minWidth: 400, maxWidth: 450,
		        offset: [0, -10], className: 'custom-popup-styled'
		    });
		    layer.on('popupopen', function(e) {
		        addClassToPopupIfMedia(e.popup.getContent(), e.popup);
		        var img = e.popup._container.querySelector('img');
		        if (img) { img.onload = function() { e.popup.update(); }; }
		    });
		}

        function style_map_data_0() {
            return {
                pane: 'pane_map_data', radius: 4.0, opacity: 1,
                color: 'rgba(35,35,35,1.0)', dashArray: '', lineCap: 'butt', lineJoin: 'miter',
                weight: 1, fill: true, fillOpacity: 1, fillColor: 'rgba(133,182,111,1.0)', interactive: true,
            }
        }
        map.createPane('pane_map_data');
        map.getPane('pane_map_data').style.zIndex = 400;
        map.getPane('pane_map_data').style['mix-blend-mode'] = 'normal';
        var layer_map_data = new L.geoJson(json_map_data, {
            attribution: '', interactive: true, dataVar: 'json_map_data',
            layerName: 'layer_map_data', pane: 'pane_map_data',
            onEachFeature: pop_map_data,
            pointToLayer: function (feature, latlng) {
                return L.circleMarker(latlng, style_map_data_0(feature));
            },
        });
        bounds_group.addLayer(layer_map_data);
        map.addLayer(layer_map_data);
        
        var LabelToggleLayer = L.Layer.extend({
            onAdd: function(m) { m.getContainer().classList.remove('labels-hidden'); },
            onRemove: function(m) { /* labels always visible - do not hide */ }
        });
        var layer_labels_map_data = new LabelToggleLayer();
        layer_labels_map_data.addTo(map);

		// ========== B/C/D/E/F/G ë ˆì´ì–´ ìƒì„± ==========
		var layer_B_data_0 = new L.geoJson(json_B_data_0, {
		    onEachFeature: function(feature, layer) {
		        pop_map_data(feature, layer);
		        bindDraggableTooltip(layer, buildLabelContent_B_data(feature), 'css_map_data_B', [0, -10]);
		    },
		    pointToLayer: function (feature, latlng) {
		        return L.circleMarker(latlng, { radius: 6, fillColor: "#3388ff", color: "#000", weight: 1, fillOpacity: 0.8 });
		    }
		});

		var layer_C_data_0 = new L.geoJson(json_C_data_0, {
		    onEachFeature: function(feature, layer) {
		        pop_map_data(feature, layer);
		        bindDraggableTooltip(layer, buildLabelContent_C_data(feature), 'css_map_data_C', [0, -10]);
		    },
		    pointToLayer: function (feature, latlng) {
		        return L.circleMarker(latlng, { radius: 6, fillColor: "#ff6b35", color: "#000", weight: 1, fillOpacity: 0.8 });
		    }
		});

		var layer_D_data_0 = new L.geoJson(json_D_data_0, {
		    onEachFeature: function(feature, layer) {
		        pop_map_data(feature, layer);
		        bindDraggableTooltip(layer, buildLabelContent_D_data(feature), 'css_map_data_D', [0, -10]);
		    },
		    pointToLayer: function (feature, latlng) {
		        return L.circleMarker(latlng, { radius: 7, fillColor: "#9333ea", color: "#000", weight: 1, fillOpacity: 0.8 });
		    }
		});

		// E ë°ì´í„° ë ˆì´ì–´ (ì˜¤í”¼ìŠ¤ - ì²­ë¡)
		var layer_E_data_0 = new L.geoJson(json_E_data_0, {
		    onEachFeature: function(feature, layer) {
		        pop_map_data(feature, layer);
		        bindDraggableTooltip(layer, buildLabelContent_E_data(feature), 'css_map_data_E', [0, -10]);
		    },
		    pointToLayer: function (feature, latlng) {
		        return L.circleMarker(latlng, { radius: 7, fillColor: "#0891b2", color: "#000", weight: 1, fillOpacity: 0.8 });
		    }
		});

		// F ë°ì´í„° ë ˆì´ì–´ (í˜¸í…” - í•‘í¬)
		var layer_F_data_0 = new L.geoJson(json_F_data_0, {
		    onEachFeature: function(feature, layer) {
		        pop_map_data(feature, layer);
		        bindDraggableTooltip(layer, buildLabelContent_F_data(feature), 'css_map_data_F', [0, -10]);
		    },
		    pointToLayer: function (feature, latlng) {
		        return L.circleMarker(latlng, { radius: 7, fillColor: "#db2777", color: "#000", weight: 1, fillOpacity: 0.8 });
		    }
		});

		// G ë°ì´í„° ë ˆì´ì–´ (ê³¨í”„ì¥ - í™©ê¸ˆ)
		var layer_G_data_0 = new L.geoJson(json_G_data_0, {
		    onEachFeature: function(feature, layer) {
		        pop_map_data(feature, layer);
		        bindDraggableTooltip(layer, buildLabelContent_G_data(feature), 'css_map_data_G', [0, -10]);
		    },
		    pointToLayer: function (feature, latlng) {
		        return L.circleMarker(latlng, { radius: 7, fillColor: "#d97706", color: "#000", weight: 1, fillOpacity: 0.8 });
		    }
		});

        // ========== í†µí•© ì»¨íŠ¸ë¡¤ ==========
        var baseMaps = {};
        var overlays = {
            'ì¤‘ì•™ ê³µí†µì ‘ìˆ˜ê±´': layer_map_data,
            'CRA ì¤‘ê°œë§¤ë¬¼': layer_B_data_0,
            'ë¬¼ë¥˜ì°½ê³  ì„ëŒ€ë£Œ': layer_C_data_0,
            'ë¬¼ë¥˜ì°½ê³  ê±°ë˜ì‚¬ë¡€': layer_D_data_0,
            'ì˜¤í”¼ìŠ¤ ì„ëŒ€ë£Œ ë° ê±°ë˜ì‚¬ë¡€': layer_E_data_0,
            'í˜¸í…” ê±°ë˜ì‚¬ë¡€': layer_F_data_0,
            'ê³¨í”„ì¥ ê±°ë˜ì‚¬ë¡€': layer_G_data_0
        };

        window.layerControl = L.control.layers(
            baseMaps, overlays, { collapsed: false, position: 'topright' }
        ).addTo(map);

		// ========== ë¼ë²¨ í•„ë“œ í† ê¸€ ì»¨íŠ¸ë¡¤ ==========
        (function addLabelFieldToggleControl() {
            var Control = L.Control.extend({
                options: { position: 'topright' },
                onAdd: function(m) {
                    var div = L.DomUtil.create('div', 'popup-field-toggle');
                    div.id = 'dynamic-label-toggle';
                    div.innerHTML = [
                        '<div class="title" style="font-weight:bold; margin-bottom:5px;">ë¼ë²¨ í•„ë“œ í† ê¸€</div>',
                        '<div class="actions" style="margin-bottom:5px;">',
                        '  <button type="button" data-action="all" style="font-size:10px;">ì „ì²´</button>',
                        '  <button type="button" data-action="none" style="font-size:10px;">í•´ì œ</button>',
                        '  <button type="button" data-action="reset-pos" style="font-size:10px; margin-left:4px; color:#e53e3e;">ìœ„ì¹˜ ì´ˆê¸°í™”</button>',
                        '</div>',
                        '<div class="list"></div>'
                    ].join('');
                    L.DomEvent.disableClickPropagation(div);
                    L.DomEvent.disableScrollPropagation(div);

                    div.updateUI = function() {
                        var list = div.querySelector('.list');
                        list.innerHTML = '';
                        
                        var cfg, targetLayer, buildFunc;
                        if (map.hasLayer(layer_G_data_0)) {
                            cfg = labelFieldConfig_G_data; targetLayer = layer_G_data_0; buildFunc = buildLabelContent_G_data;
                        } else if (map.hasLayer(layer_F_data_0)) {
                            cfg = labelFieldConfig_F_data; targetLayer = layer_F_data_0; buildFunc = buildLabelContent_F_data;
                        } else if (map.hasLayer(layer_E_data_0)) {
                            cfg = labelFieldConfig_E_data; targetLayer = layer_E_data_0; buildFunc = buildLabelContent_E_data;
                        } else if (map.hasLayer(layer_D_data_0)) {
                            cfg = labelFieldConfig_D_data; targetLayer = layer_D_data_0; buildFunc = buildLabelContent_D_data;
                        } else if (map.hasLayer(layer_C_data_0)) {
                            cfg = labelFieldConfig_C_data; targetLayer = layer_C_data_0; buildFunc = buildLabelContent_C_data;
                        } else if (map.hasLayer(layer_B_data_0)) {
                            cfg = labelFieldConfig_B_data; targetLayer = layer_B_data_0; buildFunc = buildLabelContent_B_data;
                        } else {
                            cfg = labelFieldConfig_map_data; targetLayer = layer_map_data; buildFunc = buildLabelContent_map_data;
                        }

						function refresh() {
						    targetLayer.eachLayer(function(lyr) {
						        lyr.unbindTooltip();
						        var newContent = buildFunc(lyr.feature);
						        if (newContent) {
						            var className = 'css_map_data_A';
						            if (targetLayer === layer_B_data_0) className = 'css_map_data_B';
						            if (targetLayer === layer_C_data_0) className = 'css_map_data_C';
						            if (targetLayer === layer_D_data_0) className = 'css_map_data_D';
						            if (targetLayer === layer_E_data_0) className = 'css_map_data_E';
						            if (targetLayer === layer_F_data_0) className = 'css_map_data_F';
						            if (targetLayer === layer_G_data_0) className = 'css_map_data_G';
						            var offset = getStoredOffset(lyr.feature, [0, -10]);
						            lyr.bindTooltip(newContent, {
						                permanent: true, direction: 'top', className: className,
						                offset: offset, sticky: false, opacity: 1, interactive: false
						            });
						            lyr.on('tooltipopen', function() {
						                setTimeout(function() { makeDraggableTooltip(lyr); }, 50);
						            });
						        }
						    });
						    if (typeof resetLabels === 'function') { resetLabels([targetLayer]); }
						}

                        cfg.fields.forEach(function(key, i) {
                            var row = document.createElement('label');
                            row.style.display = 'block';
                            var checked = cfg.visible[key] ? 'checked' : '';
                            row.innerHTML = '<input type="checkbox" ' + checked + '> <span style="font-size:11px;">' + key + '</span>';
                            row.querySelector('input').addEventListener('change', function() {
                                cfg.visible[key] = !!this.checked;
                                refresh();
                            });
                            list.appendChild(row);
                        });

                        div.querySelector('[data-action="all"]').onclick = function() {
                            cfg.fields.forEach(function(k) { cfg.visible[k] = true; });
                            div.updateUI(); refresh();
                        };
                        div.querySelector('[data-action="none"]').onclick = function() {
                            cfg.fields.forEach(function(k) { cfg.visible[k] = false; });
                            div.updateUI(); refresh();
                        };
                        div.querySelector('[data-action="reset-pos"]').onclick = function() {
                            tooltipOffsets = {};
                            refresh();
                        };
                    };

                    m.on('overlayadd overlayremove', function() { div.updateUI(); });
                    setTimeout(function() { div.updateUI(); }, 100);
                    return div;
                }
            });
            map.addControl(new Control());
        })();
        
        setBounds();
        var i = 0;
        layer_map_data.eachLayer(function(layer) {
            var offset = getStoredOffset(layer.feature, [0, -16]);
            layer.bindTooltip(buildLabelContent_map_data(layer.feature), {permanent: true, offset: offset, className: 'css_map_data_A'});
            layer.on('tooltipopen', function() { setTimeout(function() { makeDraggableTooltip(layer); }, 50); });
            labels.push(layer);
            totalMarkers += 1;
            layer.added = true;
            addLabel(layer, i);
            i++;
        });

		// ========== í•„í„° ì„¤ì • ==========
		// type: 'text' (ê¸°ë³¸, í¬í•¨ê²€ìƒ‰), type: 'range' (ìˆ«ì ë²”ìœ„, ìµœì†Œ~ìµœëŒ€)
		var filterFieldConfig = {
		    A: [
		        { field: 'ì œì¶œì²˜',  placeholder: 'ì˜ˆ: ê¸°ì—…ì€í–‰' },
		        { field: 'ì£¼ì†Œ',    placeholder: 'ì˜ˆ: ì„œìš¸' },
		        { field: 'ë‹´ë‹¹ì',  placeholder: 'ë‹´ë‹¹ì ì´ë¦„' },
		        { field: 'ë¬¼ê±´ì¢…ë¥˜', placeholder: 'ì˜ˆ: ì•„íŒŒíŠ¸' },
		        { field: 'ìƒíƒœ',    placeholder: 'ì˜ˆ: ì™„ë£Œ' }
		    ],
		    B: [
		        { field: 'ì†Œì¬ì§€(í†µ', placeholder: 'ì˜ˆ: ì„œìš¸ ê°•ë‚¨' },
		        { field: 'êµ¬ë¶„',      placeholder: 'ì˜ˆ: í† ì§€ê±´ë¬¼' },
		        { field: 'ì„¸ë¶€ìš©ë„',  placeholder: 'ì˜ˆ: ê·¼ë¦°ìƒê°€' },
		        { field: 'ì˜ë¢°ê¸ˆì•¡', type: 'range', placeholderMin: 'ìµœì €(ì–µ)', placeholderMax: 'ìµœê³ (ì–µ)', altField: 'ì˜ë¢°ê¸ˆì•¡(' },
		        { field: '(ë‹¨ìˆœ)ì˜ˆìƒìˆ˜ìµë¥ ', type: 'range', placeholderMin: 'ìµœì €(%)', placeholderMax: 'ìµœê³ (%)', altField: '(ë‹¨ìˆœ)ì˜ˆìƒ' }
		    ],
		    C: [
		        { field: 'ë¬¼ë¥˜ì„¼í„°ëª…', placeholder: 'ì˜ˆ: ì¿ íŒ¡' },
		        { field: 'ì†Œì¬ì§€',     placeholder: 'ì˜ˆ: ê²½ê¸° ì´ì²œ' },
		        { field: 'êµ¬ë¶„',       placeholder: 'ì˜ˆ: ë³µí•©' },
		        { field: 'ì£¼ìš” ì„ì°¨ì¸', placeholder: 'ì˜ˆ: ì¿ íŒ¡' },
		        { field: 'ìƒì˜¨ ê³„ì•½ì›”ì„ëŒ€ë£Œ(ì›/Py)', type: 'range', placeholderMin: 'ìµœì €', placeholderMax: 'ìµœê³ ' },
		        { field: 'ìƒì˜¨ ê³„ì•½ì›”ê´€ë¦¬ë¹„(ì›/Py)', type: 'range', placeholderMin: 'ìµœì €', placeholderMax: 'ìµœê³ ' },
		        { field: 'ì €ì˜¨ ê³„ì•½ì›”ì„ëŒ€ë£Œ(ì›/Py)', type: 'range', placeholderMin: 'ìµœì €', placeholderMax: 'ìµœê³ ' },
		        { field: 'ì €ì˜¨ ê³„ì•½ì›”ê´€ë¦¬ë¹„(ì›/Py)', type: 'range', placeholderMin: 'ìµœì €', placeholderMax: 'ìµœê³ ' }
		    ],
		    D: [
		        { field: 'ëª…ì¹­',       placeholder: 'ì˜ˆ: ì˜¤ëšœê¸°ë¬¼ë¥˜' },
		        { field: 'ì†Œì¬ì§€',     placeholder: 'ì˜ˆ: ê²½ê¸° ì´ì²œ' },
		        { field: 'ì°½ê³ ì¢…ë¥˜',   placeholder: 'ì˜ˆ: ë³µí•©' },
		        { field: 'ì—°ë©´ì (í‰)', type: 'range', placeholderMin: 'ìµœì €', placeholderMax: 'ìµœê³ ' },
		        { field: 'í‰ë‹¹ê°€ê²©(ì›/í‰)', type: 'range', placeholderMin: 'ìµœì €', placeholderMax: 'ìµœê³ ' }
		    ],
		    E: [
		        { field: 'ë¹Œë”©ëª…',     placeholder: 'ì˜ˆ: ì•„í¬í”Œë ˆì´ìŠ¤' },
		        { field: 'ê¶Œì—­',       placeholder: 'ì˜ˆ: GBD' },
		        { field: 'í‰ë‹¹ ê±°ë˜ê°€ê²©(ì›)', type: 'range', placeholderMin: 'ìµœì €', placeholderMax: 'ìµœê³ ' },
		        { field: 'í‰ë‹¹ ë³´ì¦ê¸ˆ', type: 'range', placeholderMin: 'ìµœì €', placeholderMax: 'ìµœê³ ' },
		        { field: 'í‰ë‹¹ ì„ëŒ€ë£Œ', type: 'range', placeholderMin: 'ìµœì €', placeholderMax: 'ìµœê³ ' },
		        { field: 'í‰ë‹¹ ê´€ë¦¬ë¹„', type: 'range', placeholderMin: 'ìµœì €', placeholderMax: 'ìµœê³ ' }
		    ],
		    F: [
		        { field: 'í˜¸í…”ëª…',     placeholder: 'ì˜ˆ: ì½˜ë˜ë“œ' },
		        { field: 'ì†Œì¬ì§€',     placeholder: 'ì˜ˆ: ì„œìš¸ ì¤‘êµ¬' },
		        { field: 'ì„±ê¸‰',       placeholder: 'ì˜ˆ: 5' },
		        { field: 'ë§¤ë§¤ê¸ˆì•¡',   type: 'range', placeholderMin: 'ìµœì €(ì–µ)', placeholderMax: 'ìµœê³ (ì–µ)' }
		    ],
		    G: [
		        { field: 'ê³¨í”„ì¥ëª…(ì¸ìˆ˜ í›„ ëª…ì¹­)', placeholder: 'ì˜ˆ: ì­ë‹ˆí´ë¼ìš°ìŠ¤' },
		        { field: 'ìš´ì˜ë°©ì‹',   placeholder: 'ì˜ˆ: ëŒ€ì¤‘ì œ' },
		        { field: 'í™€ìˆ˜',       placeholder: 'ì˜ˆ: 18' },
		        { field: 'ê±°ë˜ê¸ˆì•¡',   type: 'range', placeholderMin: 'ìµœì €(ì–µ)', placeholderMax: 'ìµœê³ (ì–µ)' },
		        { field: 'í™€ë‹¹ë‹¨ê°€',   type: 'range', placeholderMin: 'ìµœì €(ì–µ)', placeholderMax: 'ìµœê³ (ì–µ)' }
		    ]
		};
		
		var activeFilterType = 'A';
		
		function buildFilterInputs(type) {
		    var container = document.getElementById('dynamic-filter-inputs');
		    var badge = document.getElementById('filter-layer-badge');
		    if (!container) return;

		    var badgeMap = {
		        G: { text: 'ê³¨í”„ì¥ ê±°ë˜ì‚¬ë¡€', bg: '#d97706' },
		        F: { text: 'í˜¸í…” ê±°ë˜ì‚¬ë¡€', bg: '#db2777' },
		        E: { text: 'ì˜¤í”¼ìŠ¤ ì„ëŒ€ë£Œ/ê±°ë˜', bg: '#0891b2' },
		        D: { text: 'ë¬¼ë¥˜ì°½ê³  ê±°ë˜ì‚¬ë¡€', bg: '#9333ea' },
		        C: { text: 'ë¬¼ë¥˜ì°½ê³  ì„ëŒ€ë£Œ', bg: '#ff6b35' },
		        B: { text: 'CRA ì¤‘ê°œë§¤ë¬¼', bg: '#3182ce' },
		        A: { text: 'ì¤‘ì•™ ê³µí†µì ‘ìˆ˜ê±´', bg: '#0051af' }
		    };
		    var b = badgeMap[type] || badgeMap.A;
		    badge.textContent = b.text;
		    badge.style.background = b.bg;

		    container.innerHTML = '';
		    var fields = filterFieldConfig[type] || [];
		    fields.forEach(function(item) {
		        var wrapper = document.createElement('div');
		        if (item.type === 'range') {
		            wrapper.style.cssText = 'flex: 1 1 0; min-width: 110px;';
		            wrapper.innerHTML =
		                '<label style="font-size:10px; color:#888; display:block; margin-bottom:2px;">' + item.field + '</label>' +
		                '<div style="display:flex; gap:2px; align-items:center;">' +
		                '<input type="text" class="range-filter-min" data-field="' + item.field + '"' +
		                (item.altField ? ' data-alt-field="' + item.altField + '"' : '') +
		                ' placeholder="' + (item.placeholderMin || 'ìµœì €') + '"' +
		                ' style="width:50%; padding:4px 5px; border:1px solid #ddd; border-radius:5px; box-sizing:border-box; font-size:10px;">' +
		                '<span style="font-size:10px; color:#aaa;">~</span>' +
		                '<input type="text" class="range-filter-max" data-field="' + item.field + '"' +
		                (item.altField ? ' data-alt-field="' + item.altField + '"' : '') +
		                ' placeholder="' + (item.placeholderMax || 'ìµœê³ ') + '"' +
		                ' style="width:50%; padding:4px 5px; border:1px solid #ddd; border-radius:5px; box-sizing:border-box; font-size:10px;">' +
		                '</div>';
		            wrapper.querySelectorAll('input').forEach(function(inp) {
		                inp.addEventListener('input', applyMultiFilter);
		            });
		        } else {
		            wrapper.style.cssText = 'flex: 1 1 0; min-width: 80px;';
		            wrapper.innerHTML =
		                '<label style="font-size:10px; color:#888; display:block; margin-bottom:2px;">' + item.field + '</label>' +
		                '<input type="text" class="multi-filter-input" data-field="' + item.field + '"' +
		                (item.altField ? ' data-alt-field="' + item.altField + '"' : '') +
		                ' placeholder="' + (item.placeholder || '') + '"' +
		                ' style="width:100%; padding:4px 7px; border:1px solid #ddd; border-radius:5px; box-sizing:border-box; font-size:11px;">';
		            wrapper.querySelector('input').addEventListener('input', applyMultiFilter);
		        }
		        container.appendChild(wrapper);
		    });
		    document.getElementById('filter-result-count').innerText = '';
		}
		
		// ìˆ«ì íŒŒì‹± í—¬í¼: ì½¤ë§ˆ ì œê±° í›„ ìˆ«ì ì¶”ì¶œ
		function parseFilterNumber(str) {
		    if (!str || str === '-') return null;
		    var cleaned = String(str).replace(/[,\sì›í‰ì–µPyã¡]/g, '');
		    var num = parseFloat(cleaned);
		    return isNaN(num) ? null : num;
		}
		
		function applyMultiFilter() {
		    var textInputs = document.querySelectorAll('.multi-filter-input');
		    var rangeMinInputs = document.querySelectorAll('.range-filter-min');
		    var rangeMaxInputs = document.querySelectorAll('.range-filter-max');
		    
		    var textFilters = [];
		    textInputs.forEach(function(input) {
		        if (input.value.trim() !== '') {
		            textFilters.push({ 
		                field: input.getAttribute('data-field'), 
		                altField: input.getAttribute('data-alt-field') || null,
		                value: input.value.toLowerCase().trim() 
		            });
		        }
		    });
		    
		    var rangeFilters = {};
		    rangeMinInputs.forEach(function(input) {
		        var field = input.getAttribute('data-field');
		        var altField = input.getAttribute('data-alt-field') || null;
		        if (!rangeFilters[field]) rangeFilters[field] = { altField: altField };
		        if (input.value.trim() !== '') rangeFilters[field].min = parseFloat(input.value.replace(/[,\s]/g, ''));
		    });
		    rangeMaxInputs.forEach(function(input) {
		        var field = input.getAttribute('data-field');
		        var altField = input.getAttribute('data-alt-field') || null;
		        if (!rangeFilters[field]) rangeFilters[field] = { altField: altField };
		        if (input.value.trim() !== '') rangeFilters[field].max = parseFloat(input.value.replace(/[,\s]/g, ''));
		    });
		    // ë¹ˆ ë²”ìœ„ í•„í„° ì œê±°
		    Object.keys(rangeFilters).forEach(function(k) {
		        if (rangeFilters[k].min === undefined && rangeFilters[k].max === undefined) delete rangeFilters[k];
		    });

		    var layerMap = { G: layer_G_data_0, F: layer_F_data_0, E: layer_E_data_0, D: layer_D_data_0, C: layer_C_data_0, B: layer_B_data_0, A: layer_map_data };
		    var targetLayer = layerMap[activeFilterType] || layer_map_data;
		    var visibleCount = 0;

		    targetLayer.eachLayer(function(layer) {
		        var props = layer.feature.properties;
		        
		        // í…ìŠ¤íŠ¸ í•„í„° ì²´í¬
		        var textMatch = textFilters.every(function(filter) {
		            var dataValue = String(props[filter.field] || '').toLowerCase();
		            if (filter.altField) {
		                var altValue = String(props[filter.altField] || '').toLowerCase();
		                return dataValue.includes(filter.value) || altValue.includes(filter.value);
		            }
		            return dataValue.includes(filter.value);
		        });
		        
		        // ë²”ìœ„ í•„í„° ì²´í¬
		        var rangeMatch = Object.keys(rangeFilters).every(function(field) {
		            var rf = rangeFilters[field];
		            var numVal = parseFilterNumber(props[field]);
		            if (numVal === null && rf.altField) numVal = parseFilterNumber(props[rf.altField]);
		            if (numVal === null) return false;
		            if (rf.min !== undefined && !isNaN(rf.min) && numVal < rf.min) return false;
		            if (rf.max !== undefined && !isNaN(rf.max) && numVal > rf.max) return false;
		            return true;
		        });
		        
		        if (textMatch && rangeMatch) {
		            if (!map.hasLayer(layer)) map.addLayer(layer);
		            visibleCount++;
		        } else {
		            if (map.hasLayer(layer)) map.removeLayer(layer);
		        }
		    });
		    document.getElementById('filter-result-count').innerText = 'ê²€ìƒ‰ ê²°ê³¼: ' + visibleCount + 'ê±´';
		    updateDashboard();
		}
		
		map.on('overlayadd overlayremove', function(e) {
		    if (map.hasLayer(layer_G_data_0)) activeFilterType = 'G';
		    else if (map.hasLayer(layer_F_data_0)) activeFilterType = 'F';
		    else if (map.hasLayer(layer_E_data_0)) activeFilterType = 'E';
		    else if (map.hasLayer(layer_D_data_0)) activeFilterType = 'D';
		    else if (map.hasLayer(layer_C_data_0)) activeFilterType = 'C';
		    else if (map.hasLayer(layer_B_data_0)) activeFilterType = 'B';
		    else activeFilterType = 'A';
		    buildFilterInputs(activeFilterType);
		});
		
		buildFilterInputs('A');
		
		// ========== ë¡œë“œë·° ==========
		var roadviewObj = null;
		var roadviewClient = null;
		var roadviewOpen = false;
		
		function openRoadview(latlng, addressText) {
		    var panel = document.getElementById('roadview-panel');
		    panel.style.display = 'block';
		    roadviewOpen = true;
		    document.getElementById('map').style.bottom = '35%';
		    document.getElementById('kakao-map').style.bottom = '35%';
		    map.invalidateSize();
		    if (!roadviewObj) {
		        roadviewObj = new kakao.maps.Roadview(document.getElementById('roadview'));
		        roadviewClient = new kakao.maps.RoadviewClient();
		    }
		    if (addressText) document.getElementById('roadview-address').innerText = 'â€” ' + addressText;
		    var kakaoLatLng = new kakao.maps.LatLng(latlng.lat, latlng.lng);
		    roadviewClient.getNearestPanoId(kakaoLatLng, 50, function(panoId) {
		        if (panoId) { roadviewObj.setPanoId(panoId, kakaoLatLng); }
		        else { document.getElementById('roadview-address').innerText = 'â€” í•´ë‹¹ ìœ„ì¹˜ì˜ ë¡œë“œë·°ê°€ ì—†ìŠµë‹ˆë‹¤.'; }
		    });
		}
		
		function closeRoadview() {
		    document.getElementById('roadview-panel').style.display = 'none';
		    roadviewOpen = false;
		    document.getElementById('map').style.bottom = '0';
		    document.getElementById('kakao-map').style.bottom = '0';
		    map.invalidateSize();
		}

		// ========== ì—‘ì…€ ë‚´ë³´ë‚´ê¸° ==========
		function exportToExcel() {
		    var pw = prompt('ì—‘ì…€ ì €ì¥ì„ ìœ„í•´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
		    if (pw !== SITE_PASSWORD) {
		        if (pw !== null) alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
		        return;
		    }
		    var layerMap = {
		        G: { layer: layer_G_data_0, fileName: 'ê³¨í”„ì¥ê±°ë˜ì‚¬ë¡€_ê²€ìƒ‰ê²°ê³¼' },
		        F: { layer: layer_F_data_0, fileName: 'í˜¸í…”ê±°ë˜ì‚¬ë¡€_ê²€ìƒ‰ê²°ê³¼' },
		        E: { layer: layer_E_data_0, fileName: 'ì˜¤í”¼ìŠ¤_ê²€ìƒ‰ê²°ê³¼' },
		        D: { layer: layer_D_data_0, fileName: 'ë¬¼ë¥˜ì°½ê³ ê±°ë˜ì‚¬ë¡€_ê²€ìƒ‰ê²°ê³¼' },
		        C: { layer: layer_C_data_0, fileName: 'ë¬¼ë¥˜ì°½ê³ ì„ëŒ€ë£Œ_ê²€ìƒ‰ê²°ê³¼' },
		        B: { layer: layer_B_data_0, fileName: 'CRAì¤‘ê°œë§¤ë¬¼_ê²€ìƒ‰ê²°ê³¼' },
		        A: { layer: layer_map_data, fileName: 'ê³µí†µì ‘ìˆ˜ê±´_ê²€ìƒ‰ê²°ê³¼' }
		    };
		    var c = layerMap[activeFilterType] || layerMap.A;

		    // 1) í™”ë©´ì— ë³´ì´ëŠ”(í•„í„° í†µê³¼) í”¼ì²˜ ìˆ˜ì§‘
		    var visibleFeatures = [];
		    c.layer.eachLayer(function(layer) {
		        if (map.hasLayer(layer)) {
		            visibleFeatures.push(layer.feature.properties);
		        }
		    });
		    if (visibleFeatures.length === 0) { alert("ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."); return; }

		    // 2) ì „ì²´ í”„ë¡œí¼í‹° í‚¤ ìˆ˜ì§‘ (ì›ë³¸ ìˆœì„œ ìµœëŒ€í•œ ë³´ì¡´)
		    var allKeys = [];
		    var keySet = {};
		    visibleFeatures.forEach(function(props) {
		        Object.keys(props).forEach(function(k) {
		            if (!keySet[k]) { keySet[k] = true; allKeys.push(k); }
		        });
		    });

		    // 3) CSV ìƒì„± (ëª¨ë“  í•„ë“œ í¬í•¨)
		    var csvRows = [allKeys.map(function(k) { return '"' + k.replace(/"/g, '""') + '"'; }).join(',')];
		    visibleFeatures.forEach(function(props) {
		        var row = allKeys.map(function(k) {
		            var val = props[k];
		            if (val === null || val === undefined) val = '';
		            return '"' + String(val).replace(/"/g, '""') + '"';
		        });
		        csvRows.push(row.join(','));
		    });

		    var blob = new Blob(["\uFEFF" + csvRows.join("\n")], { type: 'text/csv;charset=utf-8;' });
		    var link = document.createElement("a");
		    link.setAttribute("href", URL.createObjectURL(blob));
		    link.setAttribute("download", c.fileName + "_" + new Date().toLocaleDateString() + ".csv");
		    document.body.appendChild(link); link.click(); document.body.removeChild(link);
		}
		
		// ========== ì¹´ì¹´ì˜¤ ë ˆì´ì–´ í† ê¸€ ==========
		document.querySelectorAll('.kakao-layer-toggle').forEach(function(checkbox) {
		    checkbox.addEventListener('change', function(e) {
		        var layerType = e.target.getAttribute('data-type');
		        var targetMap = window.kakaoMap || window.k_map || window.kakao_map;
		        if (targetMap && targetMap.addOverlayMapTypeId) {
		            if (e.target.checked) targetMap.addOverlayMapTypeId(kakao.maps.MapTypeId[layerType]);
		            else targetMap.removeOverlayMapTypeId(kakao.maps.MapTypeId[layerType]);
		        }
		    });
		});
		
		// ========== ì™¸ë¶€ GeoJSON ==========
		var externalLabelConfig = { fields: [], visible: {} };
		var currentExternalLayer = null;
		var externalLayerGroup = L.featureGroup().addTo(map);
		
		document.getElementById('external-geojson-input').addEventListener('change', function(e) {
		    var file = e.target.files[0];
		    if (!file) return;
		    var reader = new FileReader();
		    reader.onload = function(event) {
		        try {
		            var geojsonData = JSON.parse(event.target.result);
		            externalLayerGroup.clearLayers();
		            var oldUI = document.getElementById('external-label-controls');
		            if (oldUI) oldUI.remove();
		            var features = geojsonData.features || [];
		            if (features.length === 0) { alert("íŒŒì¼ ë‚´ì— ìœ íš¨í•œ ë§¤ë¬¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."); return; }
		            var sampleProps = features[0].properties;
		            externalLabelConfig.fields = Object.keys(sampleProps);
		            externalLabelConfig.fields.forEach(function(f) {
		                externalLabelConfig.visible[f] = (f.indexOf('ì†Œì¬ì§€') !== -1 || f === 'êµ¬ë¶„' || f === 'ì„¸ë¶€ìš©ë„');
		            });
		            createExternalToggleUI(file.name);
		            currentExternalLayer = L.geoJson(geojsonData, {
		                onEachFeature: function(feature, layer) { pop_map_data(feature, layer); renderExternalLabel(layer); },
		                pointToLayer: function (feature, latlng) {
		                    return L.circleMarker(latlng, { radius: 8, fillColor: "#ff4500", color: "#ffffff", weight: 2, fillOpacity: 0.9 });
		                }
		            });
		            externalLayerGroup.addLayer(currentExternalLayer);
		            if (window.layerControl) window.layerControl.addOverlay(externalLayerGroup, "ğŸ“‚ " + file.name);
		            map.fitBounds(externalLayerGroup.getBounds());
		            alert("'" + file.name + "' ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤!");
		        } catch (err) { alert("JSON í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆê±°ë‚˜ íŒŒì¼ ì½ê¸° ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."); }
		    };
		    reader.readAsText(file);
		});
		
		function renderExternalLabel(layer) {
		    var props = layer.feature.properties;
		    var labelParts = [];
		    externalLabelConfig.fields.forEach(function(f) {
		        if (externalLabelConfig.visible[f] && props[f]) labelParts.push(String(props[f]));
		    });
		    if (labelParts.length > 0) {
		        layer.bindTooltip('<div style="text-align:center; font-weight:bold; line-height:1.4;">' + labelParts.join('<br>') + '</div>', {
		            permanent: true, offset: [0, -12], direction: 'top', className: 'css_map_data'
		        }).openTooltip();
		    } else { layer.unbindTooltip(); }
		}
		
		function createExternalToggleUI(fileName) {
		    var parent = document.getElementById('external-geojson-input').parentNode;
		    var ui = document.createElement('div');
		    ui.id = 'external-label-controls';
		    ui.style = "margin-top:10px; padding:12px; background:#fff4e5; border-radius:10px; border:1px solid #ffb366; max-height:200px; overflow-y:auto;";
		    var title = '<div style="font-size:11px; font-weight:bold; color:#d35400; margin-bottom:8px;">ğŸ“ ë¼ë²¨ í‘œì‹œ í•­ëª© ì„ íƒ (' + fileName + ')</div>';
		    var listHtml = externalLabelConfig.fields.map(function(f) {
		        return '<label style="display:block; font-size:11px; margin-bottom:4px; cursor:pointer;"><input type="checkbox" class="ext-chk" data-field="' + f + '" ' + (externalLabelConfig.visible[f] ? 'checked' : '') + '> ' + f + '</label>';
		    }).join('');
		    ui.innerHTML = title + listHtml;
		    parent.appendChild(ui);
		    ui.querySelectorAll('.ext-chk').forEach(function(chk) {
		        chk.addEventListener('change', function() {
		            externalLabelConfig.visible[this.dataset.field] = this.checked;
		            if (currentExternalLayer) currentExternalLayer.eachLayer(function(lyr) { renderExternalLabel(lyr); });
		        });
		    });
		}

		// ========== ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸ ==========
		function updateDashboard() {
		    var listContainer = document.getElementById('list-container');
		    var countElement = document.getElementById('list-count');
		    if (!map) return;
		    var bounds = map.getBounds();
		    var listHtml = '';
		    var count = 0;

		    map.eachLayer(function(layer) {
		        if ((layer instanceof L.CircleMarker || layer instanceof L.Marker) && layer.feature && bounds.contains(layer.getLatLng())) {
		            var p = layer.feature.properties;
		            count++;

		            // íƒ€ì… ê°ì§€
		            var isTypeG = p.hasOwnProperty('ê³¨í”„ì¥ëª…(ì¸ìˆ˜ í›„ ëª…ì¹­)');
		            var isTypeF = p.hasOwnProperty('í˜¸í…”ëª…');
		            var isTypeE = p.hasOwnProperty('ë¹Œë”©ëª…') && p.hasOwnProperty('í‰ë‹¹ ê±°ë˜ê°€ê²©(ì›)');
		            var isTypeD = p.hasOwnProperty('ëª…ì¹­') && p.hasOwnProperty('í‰ë‹¹ê°€ê²©(ì›/í‰)');
		            var isTypeC = p.hasOwnProperty('ë¬¼ë¥˜ì„¼í„°ëª…');
		            var isTypeB = p.hasOwnProperty('ì†Œì¬ì§€(í†µ');

		            if (isTypeG) {
		                listHtml +=
		                    '<div class="list-item type-g" onclick="focusAnyMarker(' + layer._leaflet_id + ')" ' +
		                    'style="padding:16px; border-bottom:1px solid #edf2f7; border-left:4px solid #d97706; background:#fff; cursor:pointer; margin-bottom:4px;">' +
		                    '<div style="font-size:11px; color:#d97706; font-weight:bold; margin-bottom:4px;">â›³ ê³¨í”„ì¥</div>' +
		                    '<div class="title" style="font-weight:bold; font-size:15px; color:#2d3748;">' + (p['ê³¨í”„ì¥ëª…(ì¸ìˆ˜ í›„ ëª…ì¹­)'] || 'ì •ë³´ ì—†ìŒ') + '</div>' +
		                    '<div class="price" style="color:#b45309; font-weight:800; font-size:16px; margin-top:6px;">' +
		                    (p['ê±°ë˜ê¸ˆì•¡'] && p['ê±°ë˜ê¸ˆì•¡'] !== '-' ? p['ê±°ë˜ê¸ˆì•¡'] : 'ê¸ˆì•¡ ë¯¸ì •') + '</div>' +
		                    '<div class="info" style="display:flex; flex-wrap:wrap; gap:4px; margin-top:8px;">' +
		                    (p['ëŒ€ê¶Œì—­'] ? '<span style="background:#f1f5f9; color:#475569; padding:2px 6px; border-radius:4px; font-size:11px; border:1px solid #e2e8f0;">' + p['ëŒ€ê¶Œì—­'] + '</span>' : '') +
		                    (p['ìš´ì˜ë°©ì‹'] ? '<span style="background:#f1f5f9; color:#475569; padding:2px 6px; border-radius:4px; font-size:11px; border:1px solid #e2e8f0;">' + p['ìš´ì˜ë°©ì‹'] + '</span>' : '') +
		                    (p['í™€ìˆ˜'] ? '<span style="background:#f1f5f9; color:#475569; padding:2px 6px; border-radius:4px; font-size:11px; border:1px solid #e2e8f0;">' + p['í™€ìˆ˜'] + 'H</span>' : '') +
		                    (p['í™€ë‹¹ë‹¨ê°€'] && p['í™€ë‹¹ë‹¨ê°€'] !== '-' ? '<span style="background:#fef3c7; color:#92400e; padding:2px 6px; border-radius:4px; font-size:11px; border:1px dashed #fbbf24;">í™€ë‹¹: ' + p['í™€ë‹¹ë‹¨ê°€'] + '</span>' : '') +
		                    '</div></div>';
		            } else if (isTypeF) {
		                listHtml +=
		                    '<div class="list-item type-f" onclick="focusAnyMarker(' + layer._leaflet_id + ')" ' +
		                    'style="padding:16px; border-bottom:1px solid #edf2f7; border-left:4px solid #db2777; background:#fff; cursor:pointer; margin-bottom:4px;">' +
		                    '<div style="font-size:11px; color:#db2777; font-weight:bold; margin-bottom:4px;">ğŸ¨ í˜¸í…”</div>' +
		                    '<div class="title" style="font-weight:bold; font-size:15px; color:#2d3748;">' + (p['í˜¸í…”ëª…'] || 'ì •ë³´ ì—†ìŒ') + '</div>' +
		                    '<div class="price" style="color:#db2777; font-weight:800; font-size:16px; margin-top:6px;">' +
		                    (p['ë§¤ë§¤ê¸ˆì•¡'] || 'ê¸ˆì•¡ ë¯¸ì •') + '</div>' +
		                    '<div class="info" style="display:flex; flex-wrap:wrap; gap:4px; margin-top:8px;">' +
		                    (p['ì†Œì¬ì§€'] ? '<span style="background:#f1f5f9; color:#475569; padding:2px 6px; border-radius:4px; font-size:11px; border:1px solid #e2e8f0;">' + p['ì†Œì¬ì§€'] + '</span>' : '') +
		                    (p['ì„±ê¸‰'] ? '<span style="background:#fdf2f8; color:#9d174d; padding:2px 6px; border-radius:4px; font-size:11px; border:1px solid #fbcfe8;">' + p['ì„±ê¸‰'] + 'ì„±</span>' : '') +
		                    (p['ê±°ë˜ì¼ì'] ? '<span style="background:#f8fafc; color:#64748b; padding:2px 6px; border-radius:4px; font-size:11px; border:1px dashed #cbd5e1;">' + p['ê±°ë˜ì¼ì'] + '</span>' : '') +
		                    '</div></div>';
		            } else if (isTypeE) {
		                listHtml +=
		                    '<div class="list-item type-e" onclick="focusAnyMarker(' + layer._leaflet_id + ')" ' +
		                    'style="padding:16px; border-bottom:1px solid #edf2f7; border-left:4px solid #0891b2; background:#fff; cursor:pointer; margin-bottom:4px;">' +
		                    '<div style="font-size:11px; color:#0891b2; font-weight:bold; margin-bottom:4px;">ğŸ¢ ì˜¤í”¼ìŠ¤</div>' +
		                    '<div class="title" style="font-weight:bold; font-size:15px; color:#2d3748;">' + (p['ë¹Œë”©ëª…'] || 'ì •ë³´ ì—†ìŒ') + '</div>' +
		                    '<div class="price" style="color:#0891b2; font-weight:800; font-size:16px; margin-top:6px;">' +
		                    'í‰ë‹¹ ' + (p['í‰ë‹¹ ê±°ë˜ê°€ê²©(ì›)'] || 'ë¯¸ì •') + '</div>' +
		                    '<div class="info" style="display:flex; flex-wrap:wrap; gap:4px; margin-top:8px;">' +
		                    (p['ê¶Œì—­'] ? '<span style="background:#ecfeff; color:#155e75; padding:2px 6px; border-radius:4px; font-size:11px; border:1px solid #a5f3fc;">' + p['ê¶Œì—­'] + '</span>' : '') +
		                    (p['ì†Œì¬ì§€'] ? '<span style="background:#f1f5f9; color:#475569; padding:2px 6px; border-radius:4px; font-size:11px; border:1px solid #e2e8f0;">' + p['ì†Œì¬ì§€'] + '</span>' : '') +
		                    (p['ê±°ë˜ë©´ì (í‰)'] ? '<span style="background:#f1f5f9; color:#475569; padding:2px 6px; border-radius:4px; font-size:11px; border:1px solid #e2e8f0;">' + p['ê±°ë˜ë©´ì (í‰)'] + 'í‰</span>' : '') +
		                    (p['ê±°ë˜ì‹œì (ì—°ë„)'] ? '<span style="background:#f8fafc; color:#64748b; padding:2px 6px; border-radius:4px; font-size:11px; border:1px dashed #cbd5e1;">' + p['ê±°ë˜ì‹œì (ì—°ë„)'] + '.' + p['ê±°ë˜ì‹œì (ë¶„ê¸°)'] + 'Q</span>' : '') +
		                    '</div></div>';
		            } else if (isTypeD) {
		                listHtml +=
		                    '<div class="list-item type-d" onclick="focusAnyMarker(' + layer._leaflet_id + ')" ' +
		                    'style="padding:16px; border-bottom:1px solid #edf2f7; border-left:4px solid #9333ea; background:#fff; cursor:pointer; margin-bottom:4px;">' +
		                    '<div style="font-size:11px; color:#9333ea; font-weight:bold; margin-bottom:4px;">ê±°ë˜ì‚¬ë¡€</div>' +
		                    '<div class="title" style="font-weight:bold; font-size:15px; color:#2d3748;">' + (p['ëª…ì¹­'] || 'ì •ë³´ ì—†ìŒ') + '</div>' +
		                    '<div class="price" style="color:#16a34a; font-weight:800; font-size:16px; margin-top:6px;">í‰ë‹¹ ' + (p['í‰ë‹¹ê°€ê²©(ì›/í‰)'] || 'ê¸ˆì•¡ ë¯¸ì •') + '</div>' +
		                    '<div class="info" style="display:flex; flex-wrap:wrap; gap:4px; margin-top:8px;">' +
		                    (p['ì†Œì¬ì§€'] ? '<span style="background:#f1f5f9; color:#475569; padding:2px 6px; border-radius:4px; font-size:11px; border:1px solid #e2e8f0;">' + p['ì†Œì¬ì§€'] + '</span>' : '') +
		                    (p['ì°½ê³ ì¢…ë¥˜'] ? '<span style="background:#f1f5f9; color:#475569; padding:2px 6px; border-radius:4px; font-size:11px; border:1px solid #e2e8f0;">' + p['ì°½ê³ ì¢…ë¥˜'] + '</span>' : '') +
		                    (p['ì—°ë©´ì (í‰)'] ? '<span style="background:#f1f5f9; color:#475569; padding:2px 6px; border-radius:4px; font-size:11px; border:1px solid #e2e8f0;">' + p['ì—°ë©´ì (í‰)'] + 'í‰</span>' : '') +
		                    '</div></div>';
		            } else if (isTypeC) {
		                listHtml +=
		                    '<div class="list-item type-c" onclick="focusAnyMarker(' + layer._leaflet_id + ')" ' +
		                    'style="padding:16px; border-bottom:1px solid #edf2f7; border-left:4px solid #ff6b35; background:#fff; cursor:pointer; margin-bottom:4px;">' +
		                    '<div style="font-size:11px; color:#ff6b35; font-weight:bold; margin-bottom:4px;">ë¬¼ë¥˜ì„¼í„°</div>' +
		                    '<div class="title" style="font-weight:bold; font-size:15px; color:#2d3748;">' + (p['ë¬¼ë¥˜ì„¼í„°ëª…'] || 'ì •ë³´ ì—†ìŒ') + '</div>' +
		                    '<div class="price" style="color:#e53e3e; font-weight:800; font-size:16px; margin-top:6px;">' +
		                    (p['ìƒì˜¨ ê³„ì•½ì›”ì„ëŒ€ë£Œ(ì›/Py)'] ? p['ìƒì˜¨ ê³„ì•½ì›”ì„ëŒ€ë£Œ(ì›/Py)'] + 'ì›/Py' : 'ê¸ˆì•¡ ë¯¸ì •') + '</div>' +
		                    '<div class="info" style="display:flex; flex-wrap:wrap; gap:4px; margin-top:8px;">' +
		                    (p['ì†Œì¬ì§€'] ? '<span style="background:#f1f5f9; color:#475569; padding:2px 6px; border-radius:4px; font-size:11px; border:1px solid #e2e8f0;">' + p['ì†Œì¬ì§€'] + '</span>' : '') +
		                    (p['êµ¬ë¶„'] ? '<span style="background:#f1f5f9; color:#475569; padding:2px 6px; border-radius:4px; font-size:11px; border:1px solid #e2e8f0;">' + p['êµ¬ë¶„'] + '</span>' : '') +
		                    (p['ì—°ë©´ì (Py)'] ? '<span style="background:#f1f5f9; color:#475569; padding:2px 6px; border-radius:4px; font-size:11px; border:1px solid #e2e8f0;">' + p['ì—°ë©´ì (Py)'] + ' Py</span>' : '') +
		                    '</div></div>';
		            } else if (isTypeB) {
		                listHtml +=
		                    '<div class="list-item type-b" onclick="focusAnyMarker(' + layer._leaflet_id + ')" ' +
		                    'style="padding:16px; border-bottom:1px solid #edf2f7; border-left:4px solid #3182ce; background:#fff; cursor:pointer; margin-bottom:4px;">' +
		                    '<div style="font-size:11px; color:#3182ce; font-weight:bold; margin-bottom:4px;">ì‹¤ì‹œê°„ ë§¤ë¬¼</div>' +
		                    '<div class="title" style="font-weight:bold; font-size:15px; color:#2d3748;">' + (p['ì†Œì¬ì§€(í†µ'] || 'ì£¼ì†Œ ì •ë³´ ì—†ìŒ') + '</div>' +
		                    '<div class="price" style="color:#e53e3e; font-weight:800; font-size:16px; margin-top:6px;">' + (p['ì˜ë¢°ê¸ˆì•¡'] || p['ì˜ë¢°ê¸ˆì•¡('] || 'ê¸ˆì•¡ ë¯¸ì •') + '</div>' +
		                    '<div class="info" style="display:flex; flex-wrap:wrap; gap:4px; margin-top:8px;">' +
		                    (p['ì„¸ë¶€ìš©ë„'] ? '<span style="background:#f1f5f9; color:#475569; padding:2px 6px; border-radius:4px; font-size:11px; border:1px solid #e2e8f0;">' + p['ì„¸ë¶€ìš©ë„'] + '</span>' : '') +
		                    (p['ë³´ì¦ê¸ˆ/ì›”'] ? '<span style="background:#f1f5f9; color:#475569; padding:2px 6px; border-radius:4px; font-size:11px; border:1px solid #e2e8f0;">ë³´ì¦/ì›”: ' + p['ë³´ì¦ê¸ˆ/ì›”'] + '</span>' : '') +
		                    '</div></div>';
		            } else {
		                listHtml +=
		                    '<div class="list-item type-a" onclick="focusAnyMarker(' + layer._leaflet_id + ')" ' +
		                    'style="padding:16px; border-bottom:1px solid #edf2f7; border-left:4px solid #718096; background:#f7fafc; cursor:pointer; margin-bottom:4px;">' +
		                    '<div style="font-size:11px; color:#718096; font-weight:bold; margin-bottom:4px;">ê¸°ë³¸ ë°ì´í„°</div>' +
		                    '<div class="title" style="font-weight:bold; font-size:14px; color:#4a5568;">' + (p['ì£¼ì†Œ'] || p['ê±´ëª…'] || 'ì •ë³´ ì—†ìŒ') + '</div>' +
		                    '<div class="info" style="font-size:12px; color:#718096; margin-top:6px;">' +
		                    (p['ë¬¼ê±´ì¢…ë¥˜'] || '') + ' | ' + (p['ë‹´ë‹¹ì'] ? 'ë‹´ë‹¹: ' + p['ë‹´ë‹¹ì'] : 'ë‹´ë‹¹ì ë¯¸ì •') +
		                    '</div></div>';
		            }
		        }
		    });

		    listContainer.innerHTML = listHtml || '<div style="padding:40px; color:#a0aec0; text-align:center;">í‘œì‹œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
		    countElement.innerText = count;
		}
		
		window.focusAnyMarker = function(leaflet_id) {
		    map.eachLayer(function(layer) {
		        if (layer._leaflet_id === leaflet_id) {
		            map.setView(layer.getLatLng(), 18);
		            layer.openPopup();
		        }
		    });
		};
		
		map.on('overlayadd overlayremove moveend zoomend', updateDashboard);

		var lControl = window.layerControl;

		// ========== ê±´ì¶•ë¬¼ ê²€ìƒ‰ (PythonAnywhere ì„œë²„ ì—°ë™) ==========
		// â˜…â˜…â˜… ì•„ë˜ ì£¼ì†Œë¥¼ ë³¸ì¸ PythonAnywhere ì£¼ì†Œë¡œ ë³€ê²½í•˜ì„¸ìš” â˜…â˜…â˜…
		// ì˜ˆ: 'https://yourname.pythonanywhere.com'
		var BUILDING_API = 'https://your-username.pythonanywhere.com';
		var bmPollingTimer = null;

		function openBuildingSearchModal() {
		    document.getElementById('buildingModal').classList.add('active');
		    checkBuildingServer();
		}
		function closeBuildingModal() {
		    document.getElementById('buildingModal').classList.remove('active');
		    if (bmPollingTimer) { clearInterval(bmPollingTimer); bmPollingTimer = null; }
		}

		function checkBuildingServer() {
		    var statusEl = document.getElementById('bm-server-status');
		    statusEl.innerHTML = 'â³ ì„œë²„ ì—°ê²° í™•ì¸ ì¤‘...';
		    fetch(BUILDING_API + '/api/health')
		        .then(function(r) { return r.json(); })
		        .then(function(d) {
		            if (d.bjdong_loaded) {
		                statusEl.innerHTML = 'âœ… ì„œë²„ ì—°ê²°ë¨ (ë²•ì •ë™ì½”ë“œ ' + d.bjdong_count.toLocaleString() + 'ê°œ ë¡œë“œ)';
		                statusEl.style.color = '#16a34a';
		            } else {
		                statusEl.innerHTML = 'âš ï¸ ì„œë²„ ì—°ê²°ë¨, ë²•ì •ë™ì½”ë“œ íŒŒì¼ ë¯¸ë¡œë“œ';
		                statusEl.style.color = '#d97706';
		            }
		        })
		        .catch(function() {
		            statusEl.innerHTML = 'âŒ ì„œë²„ ë¯¸ì—°ê²° â€” <code>python building_api_server.py</code> ë¨¼ì € ì‹¤í–‰í•˜ì„¸ìš”';
		            statusEl.style.color = '#dc2626';
		        });
		}

		function runBuildingSearch() {
		    var sido = document.getElementById('bm-sido').value.trim();
		    var sigungu = document.getElementById('bm-sigungu').value.trim();
		    var eupmyeondong = document.getElementById('bm-eupmyeondong').value.trim();
		    var ri = document.getElementById('bm-ri').value.trim();
		    var uses = document.getElementById('bm-uses').value.trim();

		    if (!sido || !sigungu) { alert('ì‹œë„ì™€ ì‹œêµ°êµ¬ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.'); return; }

		    var btn = document.getElementById('bm-run-btn');
		    btn.disabled = true; btn.textContent = 'â³ ê²€ìƒ‰ ì¤‘...';

		    var progressEl = document.getElementById('bm-progress');
		    var resultEl = document.getElementById('bm-result');
		    progressEl.style.display = 'block';
		    resultEl.style.display = 'none';

		    // ì§„í–‰ìƒí™© í´ë§
		    bmPollingTimer = setInterval(function() {
		        fetch(BUILDING_API + '/api/progress')
		            .then(function(r) { return r.json(); })
		            .then(function(p) {
		                document.getElementById('bm-progress-text').textContent = p.message || '';
		                document.getElementById('bm-progress-count').textContent = p.found + 'ê±´ ë°œê²¬';
		                var pct = p.total > 0 ? Math.round((p.current / p.total) * 100) : 0;
		                document.getElementById('bm-progress-fill').style.width = pct + '%';
		            }).catch(function(){});
		    }, 1000);

		    fetch(BUILDING_API + '/api/search', {
		        method: 'POST',
		        headers: { 'Content-Type': 'application/json' },
		        body: JSON.stringify({
		            sido: sido, sigungu: sigungu,
		            eupmyeondong: eupmyeondong, ri: ri,
		            target_uses: uses
		        })
		    })
		    .then(function(r) { return r.json(); })
		    .then(function(data) {
		        clearInterval(bmPollingTimer); bmPollingTimer = null;
		        btn.disabled = false; btn.textContent = 'ğŸ” ê²€ìƒ‰ ì‹œì‘';
		        document.getElementById('bm-progress-fill').style.width = '100%';

		        if (data.error) {
		            document.getElementById('bm-progress-text').textContent = 'âŒ ' + data.error;
		            return;
		        }

		        document.getElementById('bm-progress-text').textContent = 'âœ… ì™„ë£Œ!';
		        resultEl.style.display = 'block';
		        document.getElementById('bm-result-count').textContent = (data.count || 0).toLocaleString();

		        // ë¯¸ë¦¬ë³´ê¸° í…Œì´ë¸”
		        var tbody = document.getElementById('bm-result-tbody');
		        tbody.innerHTML = '';
		        (data.preview || []).forEach(function(b) {
		            tbody.innerHTML += '<tr><td>' + (b['ì†Œì¬ì§€']||'') + '</td><td>' + (b['ì£¼ìš©ë„']||'') +
		                '</td><td>' + (b['ì—°ë©´ì (ã¡)']||'') + '</td><td>' + (b['ì‚¬ìš©ìŠ¹ì¸ì¼']||'') +
		                '</td><td>' + (b['êµ¬ì¡°']||'') + '</td></tr>';
		        });

		        // ë‹¤ìš´ë¡œë“œ ë²„íŠ¼
		        var dlBtn = document.getElementById('bm-download-btn');
		        if (data.file) {
		            dlBtn.href = BUILDING_API + '/api/download/' + encodeURIComponent(data.file);
		            dlBtn.style.display = 'inline-block';
		        } else {
		            dlBtn.style.display = 'none';
		        }
		    })
		    .catch(function(err) {
		        clearInterval(bmPollingTimer); bmPollingTimer = null;
		        btn.disabled = false; btn.textContent = 'ğŸ” ê²€ìƒ‰ ì‹œì‘';
		        document.getElementById('bm-progress-text').textContent = 'âŒ ì„œë²„ ì—°ê²° ì‹¤íŒ¨: ' + err.message;
		    });
		}
        </script>        
    </body>
</html>
